<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lesson 10 ‚Äî Social Engineering (Expanded + TTS + 10-question Quiz)</title>
<style>
  :root{
    --bg:#071428; --card:#0f2136; --muted:#9db7d9; --text:#e9f6ff;
    --accent:#57a7ff; --accent2:#7ef0c8; --danger:#ff7a7a; --ok:#9ef0b2;
    --tts-height:96px; --header-height:74px; --container-pad:18px;
  }
  *{box-sizing:border-box}
  html { scroll-behavior: smooth; scroll-padding-top: calc(var(--header-height) + 18px); scroll-padding-bottom: calc(var(--tts-height) + 20px); }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{background:linear-gradient(135deg,var(--bg) 0%, #031427 100%);color:var(--text);-webkit-font-smoothing:antialiased}
  .container{max-width:1100px;margin:0 auto;padding:var(--container-pad);padding-bottom: calc(24px + var(--tts-height));}
  header{position:sticky;top:0;background:rgba(3,10,30,0.6);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.03);padding:10px 0;z-index:40}
  .hdr{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:nowrap}
  .left{display:flex;align-items:center;gap:12px;min-width:0}
  .badge{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#021024;padding:8px 12px;border-radius:999px;font-weight:800;flex-shrink:0}
  h1{font-size:clamp(20px,3.6vw,34px);margin:6px 0}
  .subtitle{color:var(--muted);font-size:14px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:18px;border-radius:12px;margin-top:16px;box-shadow:0 10px 30px rgba(0,0,0,0.45)}
  .list{padding-left:18px}
  .list li{margin:8px 0}
  .muted{color:var(--muted)}
  .callout{background:linear-gradient(180deg,rgba(126,240,193,0.04),rgba(126,240,193,0.02));border:1px solid rgba(126,240,193,0.08);padding:10px;border-radius:8px}
  .warn{background:linear-gradient(180deg,rgba(255,123,123,0.04),rgba(255,123,123,0.02));border:1px solid rgba(255,123,123,0.06);padding:10px;border-radius:8px}
  .controls{display:flex;gap:12px;margin-top:12px;flex-wrap:wrap}
  .btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);padding:10px 12px;border-radius:10px;color:var(--text);cursor:pointer;font-weight:700}
  .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#021024;border:none}
  pre{background:rgba(0,0,0,0.15);padding:12px;border-radius:8px;overflow:auto}
  footer{opacity:.9;padding:30px 0 60px;font-size:13px;color:var(--muted)}
  .section-sub{color:var(--muted);margin-top:6px;font-size:13px}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:18px;align-items:start}
  @media (max-width:1100px){ .grid{grid-template-columns:1fr} }
  .quiz .q{margin:12px 0;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02)}
  .result{margin-top:12px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02)}
  .small{font-size:13px;color:var(--muted)}
  code{background:rgba(255,255,255,0.02);padding:2px 6px;border-radius:6px}
  /* TTS bar */
  .tts-bar{position:fixed;right:18px;bottom:18px;z-index:9999;background:rgba(1,6,12,0.88);color:#00ffcc;padding:10px 12px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.6);font-family:'Share Tech Mono',monospace;display:flex;gap:8px;align-items:center;backdrop-filter:blur(6px);min-width:320px;transition:all .14s ease}
  .tts-bar button{background:linear-gradient(45deg,#ff0080,#7928ca);border:none;color:#fff;padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer;min-width:44px}
  .tts-bar .small{padding:6px 8px;min-width:36px}
  .tts-bar select,.tts-bar input[type="range"]{background:rgba(255,255,255,0.06);color:#00ffcc;border:1px solid rgba(255,255,255,0.06);padding:6px;border-radius:8px;font-family:inherit}
  .tts-highlight{background:rgba(0,255,200,0.15);transition:background 0.2s;padding:0 2px;border-radius:3px}
  @media (max-width:600px){.tts-bar{left:50%;transform:translateX(-50%);right:auto;bottom:12px;min-width:88%}}
  /* compact mode */
  .tts-bar[data-compact="true"]{min-width:58px;max-width:58px;padding:6px;border-radius:999px;gap:0;overflow:hidden}
  .tts-bar[data-compact="true"] .tts-controls{display:none}
  .tts-bar[data-compact="true"] #ttsCollapse{border-radius:999px;padding:8px;width:38px;height:38px}
  .mobile-back-btn{display:none}
  @media (max-width:1024px){
    .mobile-back-btn{
      display:inline-flex;align-items:center;gap:8px;position:fixed;left:12px;bottom:calc(12px + env(safe-area-inset-bottom));z-index:9998;text-decoration:none;padding:9px 12px;border-radius:999px;background:rgba(255,255,255,0.98);color:#021024;font-weight:700;box-shadow:0 8px 28px rgba(2,6,23,0.36);-webkit-tap-highlight-color:transparent;transition:transform .12s ease,box-shadow .12px ease;border:1px solid rgba(0,0,0,0.06);backdrop-filter:blur(6px)
    }
    .mobile-back-btn:active{transform:translateY(1px)}
    .mobile-back-btn:focus{outline:3px solid rgba(110,168,255,0.12);outline-offset:2px}
  }
  @media (max-width:900px){
    :root{--container-pad:12px;--header-height:68px}
    .hdr{flex-wrap:wrap;align-items:flex-start;padding:10px}
    .subtitle{display:block}
    .badge{padding:6px 10px}
    .container{padding-left:12px;padding-right:12px}
    .card{padding:14px}
  }
  @media (max-width:600px){
    :root{--container-pad:10px;--header-height:64px}
    .subtitle{display:none}
    .hdr{gap:8px}
    .container{padding-left:10px;padding-right:10px}
    .tts-bar{min-width:88%}
  }
  mark.tts-mark{background:rgba(0,255,200,0.15);padding:0 2px;border-radius:3px;color:inherit}
  :focus{outline:3px solid rgba(110,168,255,0.12);outline-offset:2px}
  .sidebar{position:sticky;top:calc(var(--header-height) + 10px)}
  .sidebar .card{margin-top:0}
  .sidebar .list a{display:block;padding:8px;border-radius:6px}
</style>
</head>
<body>
  <header>
    <div class="container hdr" role="banner">
      <div class="left">
        <span class="badge">Lesson 10</span>
        <div style="min-width:0;overflow:hidden">
          <strong style="display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">Social Engineering ‚Äî Expanded</strong>
          <div class="subtitle">Human hacking, psychology, detection, playbooks, TTS & quiz</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
        <button class="btn" id="downloadNotes">üì• Download Notes</button>
        <button class="btn primary" id="copyMd">üìã Copy as Markdown</button>
        <button class="btn" id="toggleTheme" aria-pressed="false" title="Toggle theme">üåó Theme</button>
      </div>
    </div>
  </header>

  <main class="container grid" role="main" aria-live="polite">
    <article class="card lesson-content" aria-live="polite">
      <h1>Social Engineering ‚Äî Human-Centric Attacks & Defenses (Deep Dive)</h1>
      <p class="section-sub">This expanded lesson includes psychology, playbooks, KPIs, exercises, a sample incident form, and a 10-question quiz.</p>

      <section class="card">
        <h2>Table of contents (expanded)</h2>
        <ul class="list">
          <li>What is Social Engineering?</li>
          <li>Psychology of persuasion ‚Äî why it works</li>
          <li>Why attackers use social engineering</li>
          <li>Typical attacker goals</li>
          <li>Common attack types & mitigations</li>
          <li>Indicators & detection signals</li>
          <li>Technical mitigations & best practices</li>
          <li>Training program roadmap</li>
          <li>Incident playbook & capture form</li>
          <li>Safe labs & exercises</li>
          <li>KPIs & dashboards</li>
          <li>Policy snippets & compliance</li>
        </ul>
      </section>

      <section class="card">
        <h2>What is Social Engineering?</h2>
        <p>
          Social engineering manipulates people to perform actions or reveal information that bypasses technical security. It's an attack surface built around human behavior, context, and trust ‚Äî often succeeding by combining reconnaissance with plausible pretexts.
        </p>
        <div class="callout"><strong>Contrast:</strong> Technical exploits target software/hardware; social engineering targets human decision-making and norms.</div>
      </section>

      <section class="card">
        <h2>Psychology of persuasion ‚Äî why social engineering works</h2>
        <p>Successful campaigns exploit universal principles:</p>
        <ul class="list">
          <li><strong>Authority:</strong> impersonating executives or IT increases compliance.</li>
          <li><strong>Reciprocity:</strong> favors lead to obligation (quid pro quo).</li>
          <li><strong>Urgency:</strong> pressured decisions reduce verification.</li>
          <li><strong>Social proof:</strong> "everyone did it" reduces skepticism.</li>
          <li><strong>Consistency:</strong> small trusts escalate to larger concessions.</li>
          <li><strong>Liking:</strong> personalization increases trust.</li>
        </ul>
        <p class="small muted">Countermeasures: friction for high-risk actions and targeted microtraining.</p>
      </section>

      <section class="card">
        <h2>Common attack types ‚Äî examples & mitigations</h2>
        <h3>Phishing & Spear Phishing</h3>
        <ol class="list">
          <li>Reconnaissance: names and roles from public sources.</li>
          <li>Crafting: realistic email with tailored details.</li>
          <li>Delivery: user clicks a cloned site and hands over credentials.</li>
        </ol>
        <p class="small muted">Mitigations: DMARC/SPF/DKIM, sandboxing, MFA, and targeted training.</p>

        <h3>Baiting (USB drop)</h3>
        <p class="small muted">Mitigations: disable autorun, device control, physical media policies.</p>

        <h3>Vishing & Smishing</h3>
        <p class="small muted">Mitigations: callback verification, restrict sensitive actions over phone/SMS.</p>

        <h3>Tailgating / Physical intrusion</h3>
        <p class="small muted">Mitigations: badge enforcement, turnstiles, reception checks, CCTV.</p>
      </section>

      <section class="card">
        <h2>Indicators & detection signals</h2>
        <ul class="list">
          <li><strong>Email signals:</strong> display-name spoofing, forwarded rules, non-matching DKIM/SPF.</li>
          <li><strong>Auth signals:</strong> unusual password resets, logins from odd geolocations.</li>
          <li><strong>Behavior signals:</strong> sudden large downloads, unusual share access.</li>
          <li><strong>Phone/SMS:</strong> requests for codes, shortened suspicious links.</li>
        </ul>
        <p class="small muted">Combine these in SIEM/EDR correlation rules to reduce false positives.</p>
      </section>

      <section class="card">
        <h2>Technical mitigations & best practices</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div>
            <h3>Email & Web</h3>
            <ul class="list">
              <li>SPF/DKIM/DMARC and reject/quarantine policy after testing.</li>
              <li>Attachment sandboxing and link rewriting in email gateways.</li>
              <li>Block malicious URLs at proxy/firewall.</li>
            </ul>
          </div>
          <div>
            <h3>Identity & Endpoint</h3>
            <ul class="list">
              <li>Enforce MFA and conditional access.</li>
              <li>Deploy EDR for credential and living-off-the-land detection.</li>
              <li>Password hygiene and password managers.</li>
            </ul>
          </div>
        </div>
        <h3>Process</h3>
        <ul class="list">
          <li>One-click "Report Phish" into SOC; SOAR actions post-analyst verification.</li>
        </ul>
      </section>

      <section class="card">
        <h2>Training program roadmap (12‚Äì18 months)</h2>
        <h3>Phase 1 ‚Äî Baseline (0‚Äì3 months)</h3>
        <ul class="list">
          <li>Policies published; company-wide awareness sessions; baseline simulation.</li>
        </ul>
        <h3>Phase 2 ‚Äî Reinforce (3‚Äì9 months)</h3>
        <ul class="list">
          <li>Role-based training, microlearning, integrate into onboarding.</li>
        </ul>
        <h3>Phase 3 ‚Äî Sustain (9‚Äì18 months)</h3>
        <ul class="list">
          <li>Continuous simulations, tabletop exercises, reward positive behavior.</li>
        </ul>
      </section>

      <section class="card">
        <h2>Incident response playbook & capture form</h2>
        <ol class="list">
          <li>Create ticket and capture reporter/time.</li>
          <li>Triage: headers, attachments, URLs, DKIM/SPF checks, mailbox queries.</li>
          <li>Contain: remove messages, block senders, isolate accounts.</li>
          <li>Forensics: export headers, mailbox logs, EDR artifacts.</li>
          <li>Rotate credentials, enforce MFA re-enrollment, remove rules.</li>
          <li>Monitor for 30 days and update defenses/training.</li>
        </ol>
        <h3>Sample capture fields</h3>
        <pre>
- Reporter name, email, phone
- Date/time of report
- Type (phish/vish/smish/tailgate/invoice fraud)
- Full message + headers
- Attachment names / URLs
- Affected accounts / hosts
- Business impact estimate
- Immediate containment actions taken
- Assigned incident owner
        </pre>
      </section>

      <section class="card quiz" aria-labelledby="quiz">
        <h2 id="quiz">10-question Quiz (self-check)</h2>

        <div class="q">
          <strong>1.</strong> Which control most reduces the effectiveness of credential-phishing emails?<br>
          <label><input type="radio" name="q1" value="a"> Requiring multi-factor authentication (MFA)</label><br>
          <label><input type="radio" name="q1" value="b"> Longer password expiry</label><br>
          <label><input type="radio" name="q1" value="c"> Disabling email headers</label>
        </div>

        <div class="q">
          <strong>2.</strong> Best immediate step if you receive an unexpected invoice requesting a wire transfer?<br>
          <label><input type="radio" name="q2" value="a"> Pay it to avoid delays</label><br>
          <label><input type="radio" name="q2" value="b"> Call the vendor using a known phone number (not the one in the email) to verify</label><br>
          <label><input type="radio" name="q2" value="c"> Reply to the email asking for more info</label>
        </div>

        <div class="q">
          <strong>3.</strong> Tailgating is which type of attack?<br>
          <label><input type="radio" name="q3" value="a"> Social/physical engineering</label><br>
          <label><input type="radio" name="q3" value="b"> Technical exploit of a server</label><br>
          <label><input type="radio" name="q3" value="c"> Malware propagation method</label>
        </div>

        <div class="q">
          <strong>4.</strong> What distinguishes spear phishing from regular phishing?<br>
          <label><input type="radio" name="q4" value="a"> It's random and sent to many addresses</label><br>
          <label><input type="radio" name="q4" value="b"> It is targeted and personalized to a specific victim</label><br>
          <label><input type="radio" name="q4" value="c"> It always contains a malware attachment</label>
        </div>

        <div class="q">
          <strong>5.</strong> Quid pro quo attacks rely on what mechanism?<br>
          <label><input type="radio" name="q5" value="a"> Promise of service in exchange for information</label><br>
          <label><input type="radio" name="q5" value="b"> Silent eavesdropping</label><br>
          <label><input type="radio" name="q5" value="c"> DNS spoofing</label>
        </div>

        <div class="q">
          <strong>6.</strong> Which email auth framework helps detect spoofed senders?<br>
          <label><input type="radio" name="q6" value="a"> SPF / DKIM / DMARC</label><br>
          <label><input type="radio" name="q6" value="b"> FTP</label><br>
          <label><input type="radio" name="q6" value="c"> SSH</label>
        </div>

        <div class="q">
          <strong>7.</strong> A good anti-phishing program should include?<br>
          <label><input type="radio" name="q7" value="a"> Realistic phishing simulations and follow-up training</label><br>
          <label><input type="radio" name="q7" value="b"> Publicly shaming careless employees</label><br>
          <label><input type="radio" name="q7" value="c"> Only technical controls, no training</label>
        </div>

        <div class="q">
          <strong>8.</strong> Which practice is riskiest for preventing tailgating?<br>
          <label><input type="radio" name="q8" value="a"> Enforcing badge checks at every entry</label><br>
          <label><input type="radio" name="q8" value="b"> Allowing employees to hold doors open for anyone who asks</label><br>
          <label><input type="radio" name="q8" value="c"> Installing turnstiles with badge readers</label>
        </div>

        <div class="q">
          <strong>9.</strong> Whaling attacks primarily target which group?<br>
          <label><input type="radio" name="q9" value="a"> End users with no privileges</label><br>
          <label><input type="radio" name="q9" value="b"> High-level executives and decision-makers</label><br>
          <label><input type="radio" name="q9" value="c"> Public web servers</label>
        </div>

        <div class="q">
          <strong>10.</strong> Which practice helps prevent success of vishing?<br>
          <label><input type="radio" name="q10" value="a"> Verifying caller identity using a company directory or callback number</label><br>
          <label><input type="radio" name="q10" value="b"> Posting employee phone numbers publicly</label><br>
          <label><input type="radio" name="q10" value="c"> Sharing passwords over the phone</label>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
          <button class="btn primary" id="grade">Grade Quiz</button>
          <button class="btn" id="showAnswers">Show Answers & Explanations</button>
          <span id="quizResult" class="small" style="margin-left:8px"></span>
        </div>

        <div id="result" class="result" role="region" aria-live="polite" tabindex="-1"></div>
      </section>

      <section class="card">
        <h2>Further reading & references</h2>
        <ul class="list">
          <li>Kevin Mitnick, "The Art of Deception"</li>
          <li>SANS whitepapers on phishing and awareness program design</li>
          <li>NIST SP 800-61r2 (Incident Response)</li>
        </ul>
      </section>

      <footer class="container" style="margin-top:18px">
        <p>¬© Defensive Training ‚Äî Social Engineering (Expanded). Adapt templates & policies to your organization's requirements.</p>
      </footer>
    </article>

    <aside class="sidebar" aria-label="Sidebar">
      <div class="card">
        <h3>Quick Links</h3>
        <ul class="list">
          <li><a href="#quiz">Quiz</a></li>
          <li><a href="#what">What is Social Engineering?</a></li>
          <li><a href="#playbook">Incident Playbook</a></li>
        </ul>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Cheat Sheet</h3>
        <div class="small" style="margin-bottom:8px"><strong>Protect:</strong> MFA, DMARC, sandboxing</div>
        <div class="small"><strong>Detect:</strong> reporting rate, mailbox rules, EDR</div>
      </div>
    </aside>
  </main>

  <!-- Mobile Back button visible on tablet/phone -->
  <a href="cyber-index.html" class="mobile-back-btn" aria-label="Back to lessons (mobile)">
    <span aria-hidden="true">‚óÄ</span><span style="font-weight:700;margin-left:6px">Lessons</span>
  </a>

  <!-- TTS bar -->
  <div id="ttsBar" class="tts-bar" aria-hidden="false" role="region" aria-label="Text to Speech Controls" data-compact="false">
    <button id="ttsCollapse" title="Collapse/Expand TTS">‚â°</button>

    <div class="tts-controls" style="display:flex;gap:8px;align-items:center;flex-wrap:nowrap">
      <button id="ttsPlay" title="Play">‚ñ∂</button>
      <button id="ttsPause" title="Pause">‚è∏</button>
      <button id="ttsStop" title="Stop">‚èπ</button>

      <span class="small">Voice</span>
      <select id="ttsVoices" aria-label="Select voice"></select>

      <span class="small">Rate</span>
      <input id="ttsRate" type="range" min="0.6" max="2" step="0.1" value="1" />

      <span class="small">Pitch</span>
      <input id="ttsPitch" type="range" min="0.6" max="2" step="0.1" value="1" />

      <button id="ttsToggleAuto" class="btn" title="Auto-read on load">A</button>
    </div>
  </div>

<script>
/* -----------------------------
   Theme, Download, Copy Markdown
   ----------------------------- */
(function(){
  const themeBtn = document.getElementById('toggleTheme');
  const themeKey = 'lesson10.theme';
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  function applyTheme(mode){
    if (mode === 'light'){
      document.documentElement.style.setProperty('--bg','#f4f7fb');
      document.documentElement.style.setProperty('--card','#ffffff');
      document.documentElement.style.setProperty('--text','#072033');
      document.documentElement.style.setProperty('--muted','#4a5875');
      document.documentElement.style.setProperty('--accent','#3b82f6');
      document.documentElement.style.setProperty('--accent2','#34d399');
    } else {
      document.documentElement.style.setProperty('--bg','#071428');
      document.documentElement.style.setProperty('--card','#0f2136');
      document.documentElement.style.setProperty('--text','#e9f6ff');
      document.documentElement.style.setProperty('--muted','#9db7d9');
      document.documentElement.style.setProperty('--accent','#57a7ff');
      document.documentElement.style.setProperty('--accent2','#7ef0c8');
    }
  }
  const stored = localStorage.getItem(themeKey);
  const initial = stored || (prefersDark ? 'dark' : 'dark');
  applyTheme(initial);
  if (themeBtn){
    themeBtn.setAttribute('aria-pressed', initial === 'dark' ? 'true' : 'false');
    themeBtn.addEventListener('click', () => {
      const cur = localStorage.getItem(themeKey) || initial;
      const next = cur === 'dark' ? 'light' : 'dark';
      localStorage.setItem(themeKey, next);
      applyTheme(next);
      themeBtn.setAttribute('aria-pressed', next === 'dark' ? 'true' : 'false');
    });
  }

  document.getElementById('downloadNotes').addEventListener('click', () => {
    const nodes = document.querySelectorAll('main article h1, main article h2, main article h3, main article p, main article li, main article pre');
    const lines = [];
    nodes.forEach(n=>{ const txt = n.innerText.trim(); if (txt) lines.push(txt); });
    const blob = new Blob([lines.join('\n\n')], {type:'text/plain'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'Lesson10_SocialEngineering_Notes.txt'; document.body.appendChild(a); a.click();
    setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 700);
  });

  document.getElementById('copyMd').addEventListener('click', async () => {
    const nodes = document.querySelectorAll('main article h1, main article h2, main article h3, main article p, main article li, main article pre');
    let md = '';
    nodes.forEach(n => {
      const tag = n.tagName.toLowerCase(); const txt = n.innerText.trim(); if (!txt) return;
      if (tag === 'h1') md += '# ' + txt + '\n\n';
      else if (tag === 'h2') md += '## ' + txt + '\n\n';
      else if (tag === 'h3') md += '### ' + txt + '\n\n';
      else if (tag === 'li') md += '- ' + txt + '\n';
      else if (tag === 'pre') md += '```\n' + txt + '\n```\n\n';
      else md += txt + '\n\n';
    });
    try { await navigator.clipboard.writeText(md); alert('Copied notes as Markdown.'); }
    catch(e){ alert('Could not copy to clipboard.'); }
  });
})();

/* -----------------------------
   Quiz logic
   ----------------------------- */
(function(){
  const answers = {
    q1: {a:true,b:false,c:false, explain:"MFA protects accounts even if credentials are phished."},
    q2: {a:false,b:true,c:false, explain:"Use a known vendor number; don't use info provided in the suspicious email."},
    q3: {a:true,b:false,c:false, explain:"Tailgating is a social/physical attack (following someone into a secure area)."},
    q4: {a:false,b:true,c:false, explain:"Spear phishing is targeted and personalized."},
    q5: {a:true,b:false,c:false, explain:"Quid pro quo offers a service in exchange for info."},
    q6: {a:true,b:false,c:false, explain:"SPF/DKIM/DMARC help detect spoofed senders."},
    q7: {a:true,b:false,c:false, explain:"Simulations + coaching are effective; shaming is harmful."},
    q8: {a:false,b:true,c:false, explain:"Allowing employees to hold doors open for anyone is risky."},
    q9: {a:false,b:true,c:false, explain:"Whaling targets executives/decision-makers."},
    q10:{a:true,b:false,c:false, explain:"Verify callers via directory/callback; don't trust caller claims alone."}
  };

  const gradeBtn = document.getElementById('grade');
  const showBtn = document.getElementById('showAnswers');
  const out = document.getElementById('result');
  const quizResult = document.getElementById('quizResult');

  gradeBtn.addEventListener('click', () => {
    let score = 0; const parts = [];
    for (let i=1;i<=10;i++){
      const q = 'q'+i; const sel = document.querySelector(`input[name="${q}"]:checked`);
      const user = sel ? sel.value : '(no answer)';
      const isCorrect = sel && answers[q][sel.value] === true;
      if (isCorrect) score++;
      parts.push(`<strong>Q${i}</strong> ‚Äî Your answer: ${user} ‚Äî ${isCorrect?'<span style="color:var(--ok)">Correct</span>':'<span style="color:var(--danger)">Incorrect</span>'}<br><em>Explanation:</em> ${answers[q].explain}`);
    }
    out.innerHTML = `<div><strong>Score:</strong> ${score} / 10</div><div style="margin-top:10px">${parts.join('<hr>')}</div>`;
    quizResult.textContent = `Score: ${score}/10`;
    quizResult.style.color = score >= 8 ? 'var(--ok)' : score >= 6 ? 'var(--accent2)' : 'var(--danger)';
    out.focus();
    out.scrollIntoView({behavior:'smooth', block:'center'});
    try { localStorage.setItem('lesson10-quiz', JSON.stringify({score, ts:Date.now()})); } catch(e){}
  });

  showBtn.addEventListener('click', () => {
    const lines = [];
    for (let i=1;i<=10;i++){ const q='q'+i; const correct = Object.keys(answers[q]).find(k=>k!=='explain' && answers[q][k]===true); lines.push(`<strong>Q${i}</strong> ‚Äî Correct: ${correct.toUpperCase()} ‚Äî ${answers[q].explain}`); }
    out.innerHTML = lines.join('<hr>');
    out.scrollIntoView({behavior:'smooth', block:'center'});
  });

  (function restore(){ try{ const raw = localStorage.getItem('lesson10-quiz'); if (!raw) return; const obj = JSON.parse(raw); if (obj && obj.score !== undefined) { quizResult.textContent = `Previous Score: ${obj.score}/10`; quizResult.style.color = obj.score >= 8 ? 'var(--ok)' : obj.score >= 6 ? 'var(--accent2)' : 'var(--danger)'; } } catch(e){} })();
})();

/* -----------------------------
   TTS module ‚Äî compact, highlight, persistence
   ----------------------------- */
(function(){
  const bar = document.getElementById('ttsBar');
  if (!bar) return;
  if (!('speechSynthesis' in window)) { bar.style.display='none'; adjustForTTS(); return; }

  const HOME = 'cyber-index.html';
  const playBtn = document.getElementById('ttsPlay');
  const pauseBtn = document.getElementById('ttsPause');
  const stopBtn = document.getElementById('ttsStop');
  const voicesSelect = document.getElementById('ttsVoices');
  const rateInput = document.getElementById('ttsRate');
  const pitchInput = document.getElementById('ttsPitch');
  const autoBtn = document.getElementById('ttsToggleAuto');
  const collapseBtn = document.getElementById('ttsCollapse');
  const lesson = document.querySelector('.lesson-content') || document.body;

  // inject desktop back button
  (function injectDesktopBack(){
    if (document.querySelector('.desktop-back-btn')) return;
    const btn = document.createElement('button');
    btn.className = 'desktop-back-btn';
    btn.type = 'button';
    btn.title = 'Back to lessons';
    btn.setAttribute('aria-label','Back to lessons');
    btn.innerText = '‚óÄ Lessons';
    Object.assign(btn.style, {
      position: 'fixed', left: '18px', top: '18px', zIndex: 9999, padding: '8px 12px', borderRadius: '10px',
      border: '1px solid rgba(255,255,255,0.06)', background: 'rgba(255,255,255,0.02)', color: 'var(--text)',
      fontWeight: 700, cursor: 'pointer', backdropFilter: 'blur(6px)'
    });
    document.body.appendChild(btn);
    function update(){ btn.style.display = window.innerWidth <= 980 ? 'none' : 'inline-flex'; }
    update(); window.addEventListener('resize', update);
    btn.addEventListener('click', ()=> { window.location.href = HOME; });
  })();

  const KEYS = { prefix:'lesson10', auto: 'lesson10.auto', voice:'lesson10.voice', rate:'lesson10.rate', pitch:'lesson10.pitch', compact:'lesson10.compact', resume:'lesson10.resume' };

  const S = { voices: [], sentences: [], idx: parseInt(localStorage.getItem(KEYS.resume) || '0',10) || 0, utterance: null, auto: localStorage.getItem(KEYS.auto) === 'true', compact: (localStorage.getItem(KEYS.compact) === 'true') || window.matchMedia('(max-width:820px)').matches, muted:false };

  function loadVoices(){
    return new Promise((resolve) => {
      let v = speechSynthesis.getVoices();
      if (v.length) { S.voices = v; resolve(v); return; }
      speechSynthesis.onvoiceschanged = () => { v = speechSynthesis.getVoices(); S.voices = v; resolve(v); };
      setTimeout(()=> { v = speechSynthesis.getVoices(); S.voices = v; resolve(v); }, 1200);
    });
  }

  async function populateVoices(){
    const voices = await loadVoices();
    if (!voicesSelect) return;
    voicesSelect.innerHTML = '';
    voices.forEach(v => {
      const opt = document.createElement('option'); opt.value = v.voiceURI || v.name; opt.textContent = `${v.name} (${v.lang})${v.default ? ' ‚Äî default' : ''}`; voicesSelect.appendChild(opt);
    });
    const stored = localStorage.getItem(KEYS.voice);
    if (stored) voicesSelect.value = stored;
  }
  populateVoices();

  function buildSentences(){
    const nodes = lesson.querySelectorAll('h1,h2,h3,p,li,pre');
    const arr = [];
    nodes.forEach(n => {
      const txt = n.innerText.trim();
      if (!txt) return;
      const parts = txt.split(/(?<=[.?!])\s+/);
      parts.forEach(p => { if (p && p.trim()) arr.push({ text: p.trim(), node: n }); });
    });
    S.sentences = arr;
  }

  function clearMarks(){
    const marks = lesson.querySelectorAll('mark.tts-mark');
    marks.forEach(m => {
      const parent = m.parentNode;
      while (m.firstChild) parent.insertBefore(m.firstChild, m);
      parent.removeChild(m);
      parent.normalize();
    });
  }
  function markSentence(node, sentence){
    if (!node) return false;
    const walker = document.createTreeWalker(node, NodeFilter.SHOW_TEXT, null, false);
    let n;
    while (n = walker.nextNode()){
      const idx = n.nodeValue.indexOf(sentence);
      if (idx >= 0){
        const range = document.createRange(); range.setStart(n, idx); range.setEnd(n, idx + sentence.length);
        const mark = document.createElement('mark'); mark.className = 'tts-mark';
        try { range.surroundContents(mark); mark.scrollIntoView({behavior:'smooth', block:'center'}); } catch(e){}
        return true;
      }
    }
    return false;
  }

  function pickVoice(val){
    return S.voices.find(v => (v.voiceURI && v.voiceURI === val) || v.name === val) || S.voices.find(v => v.default) || S.voices[0];
  }

  function speakObj(obj){
    if (!obj || !obj.text) { S.idx++; return; }
    if (speechSynthesis.speaking || speechSynthesis.pending) speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(obj.text);
    const voiceVal = (voicesSelect && voicesSelect.value) || localStorage.getItem(KEYS.voice) || '';
    const selected = pickVoice(voiceVal);
    if (selected) u.voice = selected;
    u.rate = rateInput ? parseFloat(rateInput.value) : 1;
    u.pitch = pitchInput ? parseFloat(pitchInput.value) : 1;
    u.onstart = () => { clearMarks(); if (!markSentence(obj.node, obj.text)) markSentence(document.body, obj.text); };
    u.onend = () => { S.idx++; localStorage.setItem(KEYS.resume, String(S.idx)); if (S.idx < S.sentences.length) setTimeout(()=> speakObj(S.sentences[S.idx]), 110); else { S.idx = 0; localStorage.setItem(KEYS.resume,'0'); clearMarks(); } };
    S.utterance = u;
    speechSynthesis.speak(u);
  }

  function play(i){
    if (!S.sentences.length) buildSentences();
    if (typeof i === 'number') S.idx = i;
    if (S.idx >= S.sentences.length) S.idx = 0;
    if (speechSynthesis.paused) return speechSynthesis.resume();
    speakObj(S.sentences[S.idx]);
  }
  function pauseToggle(){ if (speechSynthesis.speaking && !speechSynthesis.paused) speechSynthesis.pause(); else if (speechSynthesis.paused) speechSynthesis.resume(); }
  function stop(){ if (speechSynthesis.speaking || speechSynthesis.pending) speechSynthesis.cancel(); S.idx = 0; localStorage.setItem(KEYS.resume,'0'); clearMarks(); }
  function speakText(text){ if (!text || !text.trim()) return; if (speechSynthesis.speaking || speechSynthesis.pending) speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(text); const voiceVal = (voicesSelect && voicesSelect.value) || localStorage.getItem(KEYS.voice) || ''; const selected = pickVoice(voiceVal); if (selected) u.voice = selected; u.rate = rateInput ? parseFloat(rateInput.value) : 1; u.pitch = pitchInput ? parseFloat(pitchInput.value) : 1; speechSynthesis.speak(u); }

  function setCompact(flag){ if (!bar) return; bar.setAttribute('data-compact', flag ? 'true' : 'false'); localStorage.setItem(KEYS.compact, flag ? 'true' : 'false'); }
  function applySaved(){ const r = localStorage.getItem(KEYS.rate); const p = localStorage.getItem(KEYS.pitch); const v = localStorage.getItem(KEYS.voice); if (r && rateInput) rateInput.value = r; if (p && pitchInput) pitchInput.value = p; if (v && voicesSelect) setTimeout(()=>{ try{ voicesSelect.value = v; }catch(e){} }, 800); }

  playBtn && playBtn.addEventListener('click', ()=> { play(0); localStorage.setItem(KEYS.voice, voicesSelect.value || ''); localStorage.setItem(KEYS.rate, rateInput.value); localStorage.setItem(KEYS.pitch, pitchInput.value); });
  pauseBtn && pauseBtn.addEventListener('click', pauseToggle);
  stopBtn && stopBtn.addEventListener('click', stop);
  voicesSelect && voicesSelect.addEventListener('change', ()=> localStorage.setItem(KEYS.voice, voicesSelect.value));
  rateInput && rateInput.addEventListener('input', ()=> localStorage.setItem(KEYS.rate, rateInput.value));
  pitchInput && pitchInput.addEventListener('input', ()=> localStorage.setItem(KEYS.pitch, pitchInput.value));
  if (autoBtn){ autoBtn.style.opacity = S.auto ? '1' : '0.6'; autoBtn.addEventListener('click', ()=> { S.auto = !S.auto; localStorage.setItem(KEYS.auto, S.auto ? 'true' : 'false'); autoBtn.style.opacity = S.auto ? '1' : '0.6'; if (S.auto) play(S.idx || 0); }); }
  if (collapseBtn) collapseBtn.addEventListener('click', ()=> { const cur = bar.getAttribute('data-compact') === 'true'; setCompact(!cur); });

  (function init(){
    populateVoices();
    buildSentences();
    setCompact(S.compact);
    applySaved();
    if (S.auto) setTimeout(()=>{ try{ play(S.idx); } catch(e){} }, 700);
  })();

  function handleResize(){
    const narrow = window.matchMedia('(max-width:420px)').matches;
    const tablet = window.matchMedia('(max-width:820px)').matches && !narrow;
    const userSet = localStorage.getItem(KEYS.compact);
    if (userSet === null){
      if (narrow) setCompact(true); else setCompact(false);
    }
    const desktopBtn = document.querySelector('.desktop-back-btn');
    if (desktopBtn) desktopBtn.style.display = window.innerWidth <= 980 ? 'none' : 'inline-flex';
  }
  window.addEventListener('resize', handleResize);
  handleResize();

  // keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    const tag = (e.target && e.target.tagName || '').toLowerCase();
    if (tag === 'input' || tag === 'textarea' || e.target.isContentEditable) return;
    if (e.code === 'Space') { e.preventDefault(); if (speechSynthesis.speaking && !speechSynthesis.paused) pauseToggle(); else if (speechSynthesis.paused) pauseToggle(); else play(S.idx || 0); }
    else if (e.key === 's' || e.key === 'S') stop();
    else if (e.key === 'b' || e.key === 'B') window.location.href = HOME;
    else if (e.key === '+' || e.key === '=') { if (rateInput) { rateInput.value = Math.min(parseFloat(rateInput.value) + 0.1, parseFloat(rateInput.max)); localStorage.setItem(KEYS.rate, rateInput.value); } }
    else if (e.key === '-') { if (rateInput) { rateInput.value = Math.max(parseFloat(rateInput.value) - 0.1, parseFloat(rateInput.min)); localStorage.setItem(KEYS.rate, rateInput.value); } }
    else if (e.key === 'r' || e.key === 'R') { const sel = window.getSelection().toString().trim(); if (sel) speakText(sel); }
    else if (e.key === 'a' || e.key === 'A') { S.auto = !S.auto; localStorage.setItem(KEYS.auto, S.auto ? 'true' : 'false'); if (S.auto) play(S.idx); }
  });

  // double-tap to toggle play/pause on mobile
  (function doubleTap(){
    let last = 0;
    document.addEventListener('touchend', (ev) => {
      const now = Date.now();
      if (now - last < 350) {
        if (speechSynthesis.speaking && !speechSynthesis.paused) pauseToggle();
        else play(S.idx || 0);
        last = 0;
        return;
      }
      last = now;
    }, { passive: true });
  })();

  // voices loading fallback
  let tries = 0;
  const iv = setInterval(()=> {
    if (speechSynthesis.getVoices().length) { populateVoices(); applySaved(); clearInterval(iv); adjustForTTS(); }
    else if (++tries > 30) { applySaved(); clearInterval(iv); adjustForTTS(); }
  }, 200);

  // observe bar size
  const ro = new ResizeObserver(entries => adjustForTTS());
  ro.observe(bar);

  if (!localStorage.getItem('lesson10.tts.hint')) { setTimeout(()=> console.info('TTS shortcuts: Space play/pause ‚Ä¢ S stop ‚Ä¢ B back ‚Ä¢ +/- speed ‚Ä¢ R read selection ‚Ä¢ A toggle auto'), 1000); localStorage.setItem('lesson10.tts.hint','1'); }
})();

/* adjust for TTS bar so anchors not covered */
function adjustForTTS(){
  const bar = document.getElementById('ttsBar');
  if (!bar) return;
  const rect = bar.getBoundingClientRect();
  const cs = window.getComputedStyle(bar);
  const h = Math.ceil(rect.height + parseFloat(cs.marginTop||0) + parseFloat(cs.marginBottom||0));
  document.documentElement.style.setProperty('--tts-height', h + 'px');
  document.querySelectorAll('.container').forEach(c => c.style.paddingBottom = (24 + h) + 'px');
}
window.addEventListener('load', ()=> { setTimeout(adjustForTTS, 300); setTimeout(adjustForTTS, 900); });
window.addEventListener('resize', ()=> { setTimeout(adjustForTTS, 120); });

/* safety reminder */
console.warn('SAFETY: Use these exercises in authorized, isolated environments. Do not perform social-engineering attacks against people or organizations without permission.');
</script>
</body>
</html>
