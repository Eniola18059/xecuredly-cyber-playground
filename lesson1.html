<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lesson 1 ‚Äî Introduction to Cybersecurity (Expanded)</title>
<style>
  :root{
    --bg:#071428; --card:#0f2136; --muted:#9db7d9; --text:#e9f6ff;
    --accent:#57a7ff; --accent2:#7ef0c8; --danger:#ff7a7a; --ok:#9ef0b2;
    --tts-height:96px; --header-height:74px; --container-pad:20px;
  }
  *{box-sizing:border-box}
  html { scroll-padding-top: calc(var(--header-height) + 18px); scroll-padding-bottom: calc(var(--tts-height) + 20px); }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{background:linear-gradient(135deg,var(--bg) 0%, #031427 100%);color:var(--text);-webkit-font-smoothing:antialiased}
  .container{max-width:1100px;margin:0 auto;padding:var(--container-pad);padding-bottom: calc(28px + var(--tts-height));}
  header{position:sticky;top:0;background:rgba(3,10,30,0.6);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,0.03);padding:10px 0;z-index:40}
  .hdr{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .badge{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#021024;padding:8px 12px;border-radius:999px;font-weight:800}
  h1.title{font-size:clamp(20px,3.6vw,34px);margin:6px 0}
  .subtitle{color:var(--muted);font-size:14px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:16px;border-radius:12px;margin-top:16px;box-shadow:0 10px 30px rgba(0,0,0,0.45)}
  .hero{padding:18px}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .chip{background:rgba(255,255,255,0.02);padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px}
  .list{padding-left:18px}
  .list li{margin:8px 0}
  .muted{color:var(--muted)}
  .small{font-size:13px;color:var(--muted)}
  .callout{background:linear-gradient(180deg,rgba(126,240,193,0.04),rgba(126,240,193,0.02));border:1px solid rgba(126,240,193,0.08);padding:10px;border-radius:8px;margin-top:12px}
  .explain{margin-top:12px;padding:10px;background:rgba(255,255,255,0.01);border-radius:8px}
  .long-read p{line-height:1.5}
  .section-title{margin:0 0 8px 0}
  .q-card{margin:12px 0;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02)}
  .q-options label{display:block;margin:6px 0;cursor:pointer}
  .controls{display:flex;gap:12px;flex-wrap:wrap}
  .btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);padding:10px 12px;border-radius:10px;color:var(--text);cursor:pointer;font-weight:700;text-decoration:none}
  .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#021024;border:none}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04)}
  .result{margin-top:12px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.02)}
  pre{background:rgba(0,0,0,0.15);padding:12px;border-radius:8px;overflow:auto}
  footer{opacity:.9;padding:30px 0 60px;font-size:13px;color:var(--muted)}
  .tts-bar{position:fixed;right:18px;bottom:18px;z-index:9999;background:rgba(1,6,12,0.88);color:#00ffcc;padding:10px 12px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.6);font-family:'Share Tech Mono',monospace;display:flex;gap:8px;align-items:center;backdrop-filter:blur(6px);min-width:320px}
  .tts-bar button{background:linear-gradient(45deg,#ff0080,#7928ca);border:none;color:#fff;padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer;min-width:40px}
  .tts-bar select,.tts-bar input[type="range"]{background:rgba(255,255,255,0.06);color:#00ffcc;border:1px solid rgba(255,255,255,0.06);padding:6px;border-radius:8px;font-family:inherit}
  .tts-highlight{background:rgba(0,255,200,0.15);transition:background 0.2s;padding:0 2px;border-radius:3px}
  mark.tts-mark{background:rgba(0,255,200,0.15);padding:0 2px;border-radius:3px;color:inherit}
  @media (max-width:900px){ .hdr{flex-wrap:wrap} .container{padding:14px} .hero{padding:14px} }
  @media (max-width:600px){
    .tts-bar{left:50%;transform:translateX(-50%);right:auto;bottom:12px;min-width:88%}
    .container{padding:12px}
    .desktop-back{display:none}
    .mobile-back{display:inline-flex}
  }
  .desktop-back{display:inline-flex;align-items:center;gap:8px}
  .mobile-back{display:none}
  :focus{outline:3px solid rgba(110,168,255,0.12);outline-offset:2px}
  .killchain-table{width:100%;border-collapse:collapse;margin-top:8px}
  .killchain-table th,.killchain-table td{padding:10px;border:1px solid rgba(255,255,255,0.04);vertical-align:top}
</style>
</head>
<body>
  <header>
    <div class="container hdr" role="banner" aria-label="Lesson header">
      <div style="display:flex;gap:12px;align-items:center;min-width:0">
        <span class="badge">Lesson 1</span>
        <div style="min-width:0">
          <strong>Introduction to Cybersecurity ‚Äî Full Module (Expanded)</strong>
          <div class="small muted">Basics ‚Ä¢ Governance ‚Ä¢ Auditing ‚Ä¢ Ethical Hacking ‚Ä¢ Kill Chain ‚Ä¢ Malware</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <a href="cyber-index.html" class="btn desktop-back" id="backLink" title="Back to Lesson">‚Üê Lesson</a>
        <button class="btn ghost" id="toggleTheme" title="Toggle contrast">üåó Theme</button>
      </div>
    </div>
  </header>

  <main class="container" role="main">
    <!-- WRAP ALL LESSON SECTIONS INSIDE THIS ARTICLE FOR TTS -->
    <article class="card lesson-content" aria-live="polite">
      <section class="hero card" aria-labelledby="hero">
        <h1 class="title">Introduction to Cybersecurity</h1>
        <p class="subtitle">This lesson combines foundational concepts, governance and auditing, ethical hacking phases, the cyber kill chain, and a survey of malicious code ‚Äî now fully expanded with historical notes, practical controls, examples and labs.</p>

        <div class="chips" aria-hidden="false">
          <span class="chip">Confidentiality</span>
          <span class="chip">Integrity</span>
          <span class="chip">Availability</span>
          <span class="chip">Governance</span>
          <span class="chip">Ethical Hacking</span>
          <span class="chip">Cyber Kill Chain</span>
          <span class="chip">Malware</span>
        </div>
      </section>

      <!-- INTRO -->
      <section class="card long-read" aria-labelledby="intro">
        <h2 id="intro" class="section-title">1. What is Cybersecurity?</h2>
        <p>
          Cybersecurity is the discipline and practice of protecting systems, networks, programs, and data from digital attacks.
          As people, businesses and services move online, sensitive information (personal data, financial records, intellectual property)
          becomes valuable to attackers. Cybersecurity combines technologies, policies, and processes to reduce risk and ensure systems remain available,
          correct, and private.
        </p>
        <p class="small muted">Historical note: the earliest known experimental self-replicating program was the Creeper in the 1970s ‚Äî a reminder that threats have
          evolved as computing systems did.</p>

        <div class="explain">
          <strong>Core tasks in practice:</strong>
          <ul class="list">
            <li>Identify and classify assets and data.</li>
            <li>Harden systems and applications (patching, secure configuration).</li>
            <li>Monitor systems for anomalies using logs, EDR and SIEM.</li>
            <li>Respond to incidents and recover with tested plans and backups.</li>
            <li>Train people and set clear policies for secure behaviour.</li>
          </ul>
        </div>
      </section>

      <!-- FIRST VIRUS -->
      <section class="card long-read" aria-labelledby="creeper">
        <h2 id="creeper" class="section-title">2. First Computer Virus ‚Äî Creeper (historical)</h2>
        <p>
          The Creeper program (early 1970s) was an experimental self-replicating program that moved between DEC PDP systems and displayed the message:
          <em>"I'M THE CREEPER: CATCH ME IF YOU CAN."</em> It demonstrated that code could propagate between machines ‚Äî a concept central to modern malware.
        </p>
        <p class="small muted">While Creeper caused no deliberate harm, later malware adopted the replication idea and added destructive or covert payloads.</p>
      </section>

      <!-- NEED -->
      <section class="card long-read" aria-labelledby="need">
        <h2 id="need" class="section-title">3. Why Cybersecurity is Needed</h2>
        <p>
          Cybersecurity protects data against theft, misuse, and unauthorized disclosure. Without it, attackers can steal personal information,
          drain bank accounts, disrupt critical services, or hold data hostage (ransomware). Security also prevents operational disruption caused
          by malware or targeted attacks that can harm an organization's reputation and finances.
        </p>
        <div class="callout">
          <strong>Real-world stakes:</strong> loss of customer trust, regulatory fines, business downtime and intellectual property theft all come with
          real financial and human costs.
        </div>

        <div class="explain">
          <strong>Typical defensive measures:</strong>
          <ul class="list">
            <li>Strong authentication (MFA) and identity management.</li>
            <li>Encryption of data at rest and in transit.</li>
            <li>Patching and vulnerability management.</li>
            <li>Backups and offline recovery copies.</li>
            <li>User education and phishing simulations.</li>
          </ul>
        </div>
      </section>

      <!-- CYBER CRIME -->
      <section class="card long-read" aria-labelledby="crime">
        <h2 id="crime" class="section-title">4. Cyber Crime ‚Äî Common Examples</h2>
        <p>
          Cyber crimes are offenses that use computers or networks as tools or targets. Typical examples include illegal interception of data (eavesdropping),
          identity theft, online fraud, distribution of illegal materials, and intellectual property theft. Attackers may sell stolen data or use it to launch
          further attacks.
        </p>
        <ul class="list">
          <li>Illegal interception & network eavesdropping (MitM attacks).</li>
          <li>Copyright infringement and software piracy.</li>
          <li>Sale of illegal items on darknet marketplaces.</li>
          <li>Phishing, business email compromise, and social engineering scams.</li>
        </ul>
        <div class="explain">
          <strong>Actors:</strong> lone hackers, criminal gangs, insider threats, hacktivists, and state-sponsored groups. Defenses include legal enforcement,
          proactive monitoring, and strong encryption.
        </div>
      </section>

      <!-- PRINCIPLES -->
      <section class="card long-read" aria-labelledby="principles">
        <h2 id="principles" class="section-title">5. Cybersecurity Principles (The Core Goals)</h2>
        <p>
          A strong security program is built on several core principles. The most well-known triad is <strong>Confidentiality, Integrity, and Availability (CIA)</strong>.
          Additional essentials include Accountability and Auditability, which ensure actions are traceable and systems can be evaluated.
        </p>

        <h3>Confidentiality</h3>
        <p class="long-read">Confidentiality means protecting sensitive information so only authorized parties can access it. Examples include encryption of data at rest and in transit, and strict access control policies.</p>

        <h3>Integrity</h3>
        <p>Integrity ensures data is accurate and has not been tampered with. Mechanisms like hashes, signatures, and checksums help detect unauthorized changes.</p>

        <h3>Availability</h3>
        <p>Availability ensures systems and data are accessible when authorized users need them. Defensive measures include redundancy, backups, and DDoS protection.</p>

        <h3>Accountability & Auditability</h3>
        <p>Accountability ties actions to users (or systems) so responsibilities are clear. Auditability means maintaining logs and controls that let auditors verify compliance and investigate incidents.</p>
      </section>

      <!-- ARCHITECTURE -->
      <section class="card long-read" aria-labelledby="architecture">
        <h2 id="architecture" class="section-title">6. Cybersecurity Architecture & Key Areas</h2>
        <p>
          Security architecture is the structured approach that defines and organizes the technologies, processes, and controls used to secure an organization.
          A modern architecture often follows zero-trust principles: verify every device and user, grant least privilege, and require strong telemetry and automation.
        </p>
        <h3>Key areas to design and operate</h3>
        <ul class="list">
          <li>Security protocols and encryption</li>
          <li>Account creation, identity lifecycle, and access management</li>
          <li>Defined security roles and responsibilities</li>
          <li>Continuous auditing and monitoring</li>
        </ul>
        <div class="explain">
          <strong>Zero-Trust idea:</strong> don't trust by default ‚Äî always verify. That means device posture checks, MFA, segmentation, and strict logging.
        </div>

        <div class="callout">
          <strong>REACP (expanded suggestion):</strong>
          <p class="small muted">The original deck used the label <em>REACP</em> without defining it. Below is a practical expansion you can include if useful:</p>
          <ol class="list">
            <li><strong>R ‚Äî Risk</strong>: identify and prioritise risks to critical assets; use risk assessments to drive controls.</li>
            <li><strong>E ‚Äî Endpoints</strong>: secure devices with EDR, hardening, and patching.</li>
            <li><strong>A ‚Äî Access</strong>: identity, MFA, least privilege and access reviews.</li>
            <li><strong>C ‚Äî Controls/Confidentiality</strong>: encryption, DLP, network controls and microsegmentation.</li>
            <li><strong>P ‚Äî Policies & People</strong>: governance, training, and incident response plans.</li>
          </ol>
          <p class="small muted">If you prefer a different expansion for REACP, tell me which words you want and I will update everywhere.</p>
        </div>
      </section>

      <!-- GOVERNANCE -->
      <section class="card long-read" aria-labelledby="governance">
        <h2 id="governance" class="section-title">7. Cybersecurity Governance</h2>
        <p>
          Governance gives strategic direction and accountability for security across the organization. It defines policies, decision-making, and how security supports business goals.
          A governance program includes assessments, standards, and a roadmap for continuous improvement.
        </p>
        <h3>Governance vs Management</h3>
        <p class="long-read">Governance is board-level oversight (risk appetite, policy, budget), while management implements the day-to-day controls and operations (SOC, patching, incident response).</p>
        <h3>Practical outputs</h3>
        <ul class="list">
          <li>Policies and standards (acceptable use, encryption, incident response).</li>
          <li>Risk acceptance decisions and budgeting.</li>
          <li>Defined roles (CISO, Data Protection Officer) and reporting lines.</li>
        </ul>
      </section>

      <!-- GOVERNANCE STEPS -->
      <section class="card long-read" aria-labelledby="govsteps">
        <h2 id="govsteps" class="section-title">8. 6 Steps for Effective Cybersecurity Governance</h2>
        <ol class="list">
          <li><strong>Establish Current State:</strong> asset inventory, data flow mapping, baseline controls and known incidents.</li>
          <li><strong>Conduct Assessments:</strong> risk, maturity and vulnerability assessments to surface gaps.</li>
          <li><strong>Identify Vulnerabilities:</strong> triage and prioritise fixes by business impact (use CVSS + business context).</li>
          <li><strong>Develop Standards:</strong> policies, technical standards and runbooks for common operations.
          </li>
          <li><strong>Implement Policies:</strong> assign owners, automate enforcement where possible, and train staff.</li>
          <li><strong>Enterprise-wide Approach:</strong> align security with procurement, legal and business units; include third-party risk management.</li>
        </ol>
      </section>

      <!-- AUDITING -->
      <section class="card long-read" aria-labelledby="auditing">
        <h2 id="auditing" class="section-title">9. Security Auditing</h2>
        <p>
          Security auditing is a formal, methodical assessment of an organization‚Äôs security posture ‚Äî measuring how well people, processes and technology meet agreed standards.
          Audits help demonstrate compliance, find gaps, and provide prioritized recommendations for improvement.
        </p>
        <h3>Types of audits</h3>
        <ul class="list">
          <li>Internal audits (performed by internal teams).</li>
          <li>External/third-party audits and compliance assessments.</li>
          <li>Technical penetration tests and code reviews.</li>
        </ul>
      </section>

      <!-- AUDIT STEPS -->
      <section class="card long-read" aria-labelledby="auditsteps">
        <h2 id="auditsteps" class="section-title">10. Security Auditing ‚Äî Typical Steps</h2>
        <ol class="list">
          <li><strong>Define scope:</strong> systems, networks and data included, plus rules of engagement.</li>
          <li><strong>Assess compliance:</strong> compare controls to frameworks (NIST, ISO, PCI).</li>
          <li><strong>Test controls:</strong> sample evidence collection and technical checks.</li>
          <li><strong>Identify vulnerabilities:</strong> scanning, manual testing and code review.</li>
          <li><strong>Analyze incident readiness:</strong> tabletop exercises and playbook reviews.</li>
          <li><strong>Provide recommendations:</strong> prioritized remediation with owners and deadlines.</li>
        </ol>
      </section>

      <!-- COMPLIANCE -->
      <section class="card long-read" aria-labelledby="compliance">
        <h2 id="compliance" class="section-title">11. Compliance & Regulatory Frameworks</h2>
        <p>
          Organizations follow frameworks and regulations to demonstrate they protect data and meet legal obligations. Examples commonly referenced in enterprise environments include SOX, NIST and PCI-DSS.
        </p>
        <h3>SOX</h3>
        <p class="long-read">The Sarbanes-Oxley Act focuses on financial controls and accurate reporting for publicly traded companies. Section 404 is notable for internal control attestation.</p>
        <h3>NIST</h3>
        <p class="long-read">NIST provides frameworks (SP 800 series, CSF) for risk management: Identify, Protect, Detect, Respond and Recover ‚Äî widely adopted as best practice.</p>
        <h3>PCI-DSS</h3>
        <p class="long-read">PCI-DSS governs cardholder data protection ‚Äî 12 requirements covering network security, encryption, access controls, monitoring and testing.</p>
      </section>

      <!-- ETHICAL HACKING -->
      <section class="card long-read" aria-labelledby="ethical">
        <h2 id="ethical" class="section-title">12. Introduction to Ethical Hacking</h2>
        <p>
          Ethical hacking (penetration testing) uses attacker techniques under legal permission to find weaknesses before criminals do. Typical deliverables include a report with findings, evidence and remediation guidance.
        </p>
        <h3>Engagement types</h3>
        <ul class="list">
          <li>Vulnerability assessments</li>
          <li>Penetration tests</li>
          <li>Red team (adversary emulation)</li>
          <li>Purple team (collaborative improvement between red & blue)</li>
        </ul>
      </section>

      <!-- HACKER TYPES -->
      <section class="card long-read" aria-labelledby="hackertypes">
        <h2 id="hackertypes" class="section-title">13. Types of Hackers</h2>
        <p>Hackers are often classified by skill and intent:</p>
        <ul class="list">
          <li><strong>White hat:</strong> authorized security testers.</li>
          <li><strong>Black hat:</strong> malicious attackers.</li>
          <li><strong>Grey hat:</strong> in-between ‚Äî sometimes ethically ambiguous.</li>
          <li><strong>Script kiddies:</strong> low-skill attackers using tools.</li>
          <li><strong>Hacktivists:</strong> ideologically motivated attackers.</li>
          <li><strong>State-sponsored:</strong> highly resourced actors.</li>
          <li><strong>Insider threats:</strong> negligent or malicious employees.</li>
        </ul>
      </section>

      <!-- PHASES -->
      <section class="card long-read" aria-labelledby="phases">
        <h2 id="phases" class="section-title">14. Phases of Ethical Hacking</h2>
        <p>
          Ethical hacking follows repeatable phases: reconnaissance/footprinting, scanning, gaining access, maintaining access (persistence), and clearing tracks. Each phase has tools, goals and safe rules-of-engagement for testers.
        </p>
        <ol class="list">
          <li><strong>Footprinting:</strong> passive OSINT and public data collection.</li>
          <li><strong>Scanning:</strong> active discovery of hosts, services and vulnerabilities.</li>
          <li><strong>Gaining Access:</strong> exploitation or credential attacks.</li>
          <li><strong>Maintaining Access:</strong> persistence techniques for simulation purposes.
          </li>
          <li><strong>Clearing Tracks:</strong> demonstrate attacker techniques without damaging or removing forensic evidence; ethical testers document findings instead of wiping logs.
          </li>
        </ol>
      </section>

      <!-- FOOTPRINTING -->
      <section class="card long-read" aria-labelledby="footprinting">
        <h2 id="footprinting" class="section-title">15. Footprinting (Reconnaissance)</h2>
        <p>
          Footprinting is the first step: gather information about a target using passive and active methods. Passive techniques avoid touching the target and are stealthier; active techniques (scans, traceroutes) are more likely to be detected.
        </p>
        <div class="explain">
          <strong>Examples:</strong>
          <ul class="list">
            <li>Passive: Google dorking, WHOIS, certificate transparency, public job posts.</li>
            <li>Active: ping sweeps, port scans, banner grabbing (requires permission).</li>
          </ul>
        </div>
      </section>

      <!-- SCANNING -->
      <section class="card long-read" aria-labelledby="scanning">
        <h2 id="scanning" class="section-title">16. Scanning</h2>
        <p>
          Scanning identifies live hosts, open ports and running services, performs OS fingerprinting and discovers possible vulnerabilities. It converts passive intelligence into a practical attack surface map.
        </p>
        <h3>Tools & outputs</h3>
        <ul class="list">
          <li>Nmap (port/service discovery)</li>
          <li>Nessus/OpenVAS (vulnerability scanning)</li>
          <li>Network mapping and topology diagrams for attack planning</li>
        </ul>
      </section>

      <!-- GAINING ACCESS -->
      <section class="card long-read" aria-labelledby="gaining">
        <h2 id="gaining" class="section-title">17. Gaining Access (Exploitation)</h2>
        <p>
          Gaining access is when an attacker exploits weaknesses to enter systems. Methods include password attacks, social engineering, software exploits, and malware delivery.
        </p>
        <div class="explain">
          <strong>Common mitigations:</strong>
          <ul class="list">
            <li>Multi-factor authentication (MFA)</li>
            <li>Strong password policies and credential monitoring</li>
            <li>Patch management and secure configurations</li>
            <li>User education against phishing</li>
          </ul>
        </div>
      </section>

      <!-- MAINTAINING -->
      <section class="card long-read" aria-labelledby="maintain">
        <h2 id="maintain" class="section-title">18. Maintaining Access (Persistence)</h2>
        <p>
          Persistence techniques (backdoors, cron jobs, created accounts, rootkits) let attackers remain after initial compromise. Ethical tests demonstrate these techniques so defenders can detect and remove them.
        </p>
        <h3>Detection</h3>
        <p class="long-read">EDR, scheduled integrity checks, privilege reviews and centralized logging help detect persistence. Rapid isolation and forensics are critical once discovered.</p>
      </section>

      <!-- CLEARING TRACKS -->
      <section class="card long-read" aria-labelledby="clearing">
        <h2 id="clearing" class="section-title">19. Clearing Tracks (Anti-forensics)</h2>
        <p>
          Attackers will attempt to remove evidence: delete or tamper with logs, alter timestamps, and uninstall tools. Ethical testers should report these possibilities rather than destroy evidence.
        </p>
        <div class="explain">
          <strong>Defensive countermeasures:</strong>
          <ul class="list">
            <li>Remote, immutable logging (write-once storage)</li>
            <li>Frequent forensic snapshots and backups</li>
            <li>Endpoint protections preventing log tampering</li>
          </ul>
        </div>
      </section>

      <!-- MITRE -->
      <section class="card long-read" aria-labelledby="mitre">
        <h2 id="mitre" class="section-title">20. MITRE ATT&CK</h2>
        <p>
          MITRE ATT&CK is a knowledge base of adversary tactics and techniques used to model threats and improve detection. Map your telemetry to ATT&CK to find coverage gaps and prioritise detections.
        </p>

        <h3>MITRE ATT&CK Enterprise ‚Äî High-level Tactics</h3>
        <ol class="list">
          <li>Reconnaissance ‚Äî Gathering information about the target.</li>
          <li>Resource Development ‚Äî Establishing infrastructure/tools for attack.</li>
          <li>Initial Access ‚Äî Gaining entry into the environment.</li>
          <li>Execution ‚Äî Running malicious code.</li>
          <li>Persistence ‚Äî Maintaining access after reboot or reset.</li>
          <li>Privilege Escalation ‚Äî Gaining higher permissions.</li>
          <li>Defense Evasion ‚Äî Avoiding detection and security controls.</li>
          <li>Credential Access ‚Äî Stealing usernames, passwords, and tokens.</li>
          <li>Discovery ‚Äî Learning about the network, users, and systems.</li>
          <li>Lateral Movement ‚Äî Moving through the environment to other systems.</li>
          <li>Collection ‚Äî Gathering data of interest.</li>
          <li>Command and Control (C2) ‚Äî Communicating with attacker-controlled systems.</li>
          <li>Exfiltration ‚Äî Stealing and moving data out of the environment.</li>
          <li>Impact ‚Äî Achieving the end goal (disruption, destruction, or data manipulation).</li>
        </ol>

        <p class="small muted">For deeper study, consult the official MITRE ATT&CK site: <a href="https://attack.mitre.org/" target="_blank" rel="noopener noreferrer">attack.mitre.org</a></p>
      </section>

      <!-- KILL CHAIN -->
      <section class="card long-read" aria-labelledby="killchain">
        <h2 id="killchain" class="section-title">21. The Cyber Kill Chain (Lockheed Martin) ‚Äî Practical Walkthrough</h2>
        <p>
          The Kill Chain describes phases of an attack from initial reconnaissance to the attacker's objectives. Below is a step-by-step practical explanation grounded in SOC and fraud examples ‚Äî with defender actions you can take to detect and break the chain early.
        </p>

        <!-- Practical stages -->
        <ol class="list">
          <li>
            <strong>1. Reconnaissance (Planning & Target Research)</strong>
            <div class="explain">
              <strong>What happens:</strong> Attackers gather publicly available and leaked information to plan their approach.<br/>
              <strong>Practical examples:</strong> scanning company IP ranges for open ports (SSH/RDP), scraping LinkedIn to identify high-value employees, using Shodan or certificate transparency to find exposed services.<br/>
              <strong>Defender's role:</strong> monitor firewall/SIEM logs for suspicious scanning, restrict public exposure and train staff on oversharing, subscribe to threat intelligence and monitor for your domains/assets.
            </div>
          </li>

          <li>
            <strong>2. Weaponization (Building the Attack Payload)</strong>
            <div class="explain">
              <strong>What happens:</strong> The attacker crafts a payload or exploit tailored to the target.<br/>
              <strong>Practical examples:</strong> preparing a malicious Excel macro or PDF that downloads a backdoor; cloning a banking login page for credential harvesting; packaging an exploit for an unpatched service (e.g., Log4j-style exploit).<br/>
              <strong>Defender's role:</strong> patch management, sandbox attachments, create YARA rules and detection signatures for known malicious payloads, and block executable downloads from untrusted sources.
            </div>
          </li>

          <li>
            <strong>3. Delivery (Sending the Attack to the Target)</strong>
            <div class="explain">
              <strong>What happens:</strong> The attacker transmits the weaponized item to the victim.<br/>
              <strong>Practical examples:</strong> phishing emails with infected attachments or links, dropping a USB stick in a parking lot (baiting), watering-hole compromises of frequently visited sites.<br/>
              <strong>Defender's role:</strong> secure email gateways and URL scanning, endpoint protections to block malicious payloads, user awareness training and simulated phishing campaigns.
            </div>
          </li>

          <li>
            <strong>4. Exploitation (Triggering the Payload)</strong>
            <div class="explain">
              <strong>What happens:</strong> The malicious code executes, exploiting a vulnerability or tricking a user to run it.<br/>
              <strong>Practical examples:</strong> a user opens a document that spawns PowerShell to download a backdoor; a browser exploit that gives remote code execution; an unpatched server exploited remotely.<br/>
              <strong>Defender's role:</strong> monitor EDR for suspicious child processes (e.g., PowerShell spawned by Word), harden systems (disable macros, enforce least privilege), and hunt for exploit indicators in logs.
            </div>
          </li>

          <li>
            <strong>5. Installation (Persistence & Foothold)</strong>
            <div class="explain">
              <strong>What happens:</strong> The attacker installs software or implants persistence mechanisms to maintain access.<br/>
              <strong>Practical examples:</strong> installing a RAT, creating scheduled tasks or service entries, creating stealthy user accounts, or dropping credential harvesters.<br/>
              <strong>Defender's role:</strong> file integrity monitoring, detect unusual registry edits or new services, limit admin rights, and use EDR to detect persistence primitives.
            </div>
          </li>

          <li>
            <strong>6. Command & Control (C2)</strong>
            <div class="explain">
              <strong>What happens:</strong> The compromised host communicates with attacker infrastructure for commands and data exfiltration.<br/>
              <strong>Practical examples:</strong> periodic beaconing to a C2 server, DNS tunnelling, or hiding C2 in HTTPS or legitimate cloud APIs (Slack/Telegram).<br/>
              <strong>Defender's role:</strong> monitor outbound traffic and DNS for anomalies, use proxies and egress filtering, block known malicious domains/IPs, and inspect unusual encrypted traffic patterns.
            </div>
          </li>

          <li>
            <strong>7. Actions on Objectives (Exfiltration, Impact)</strong>
            <div class="explain">
              <strong>What happens:</strong> The attacker performs their goal: steal data, disrupt operations, or commit fraud.<br/>
              <strong>Practical examples:</strong> exfiltrating customer data, encrypting systems for ransomware, creating fraudulent transactions, or destroying backups.<br/>
              <strong>Defender's role:</strong> DLP to detect sensitive data movement, incident response playbooks (ransomware, data breach), rapid containment and forensics, and notification procedures.
            </div>
          </li>
        </ol>

        <p class="small muted">Key takeaway: break the chain as early as possible (reconnaissance or delivery) to prevent later stages from occurring.</p>

        <p class="small muted">More context & discussion on Lockheed Martin's Kill Chain: <a href="https://darkmarc.substack.com/p/the-cyber-kill-chain-lockheed-martins" target="_blank" rel="noopener noreferrer">darkmarc: The Cyber Kill Chain ‚Äî Lockheed Martin's model</a></p>

        <!-- Side-by-side visual table: stage | attacker action | defender countermeasure -->
        <div style="overflow:auto;margin-top:12px">
          <table class="killchain-table" aria-label="Cyber Kill Chain stages and defenses">
            <thead>
              <tr>
                <th style="width:20%">Stage</th>
                <th style="width:40%">Attacker action (example)</th>
                <th style="width:40%">Defender countermeasure (practical)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="killchain-stage">Reconnaissance</span></td>
                <td>Scanning IP ranges, OSINT (LinkedIn, Shodan), mapping org structure.</td>
                <td>Monitor logs for scans, limit public exposure, use threat feeds and staff training.</td>
              </tr>
              <tr>
                <td><span class="killchain-stage">Weaponization</span></td>
                <td>Crafting malicious macro/PDF, building phishing landing pages, exploit dev.</td>
                <td>Patch management, sandbox attachments, create detection rules (YARA).</td>
              </tr>
              <tr>
                <td><span class="killchain-stage">Delivery</span></td>
                <td>Phishing email with link/attachment, physical baiting (USB), watering-hole.</td>
                <td>Secure email gateway, URL scanning, EDR to block downloads, phishing training.</td>
              </tr>
              <tr>
                <td><span class="killchain-stage">Exploitation</span></td>
                <td>Macro executes, browser exploit runs, remote exploit on unpatched service.</td>
                <td>Harden hosts (disable macros), monitor EDR for process anomalies, patching.</td>
              </tr>
              <tr>
                <td><span class="killchain-stage">Installation</span></td>
                <td>Install RAT, create scheduled tasks, drop persistence artifacts.</td>
                <td>File integrity monitoring, limit admin rights, EDR detection/playbooks.</td>
              </tr>
              <tr>
                <td><span class="killchain-stage">Command & Control</span></td>
                <td>Beaconing to C2, DNS tunnelling, use of cloud APIs for communications.</td>
                <td>Egress filtering, DNS monitoring, block/inspect unusual encrypted traffic.</td>
              </tr>
              <tr>
                <td><span class="killchain-stage">Actions on Objectives</span></td>
                <td>Data exfiltration, ransomware encryption, fraud operations.</td>
                <td>DLP, backups/immutable storage, incident response and fast containment.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- MALICIOUS CODE -->
      <section class="card long-read" aria-labelledby="malcode">
        <h2 id="malcode" class="section-title">22. Types of Malicious Code (Malware)</h2>
        <p>
          Malware is software created to harm systems, steal data, or disrupt operations. Below are common families, examples, and mitigations.
        </p>
        <h3>Virus</h3>
        <p class="long-read">Attaches to files or programs and spreads when executed. Examples: ILOVEYOU. Mitigations: antivirus, file integrity monitoring, user training.</p>

        <h3>Worm</h3>
        <p class="long-read">Self-replicating across networks (e.g., WannaCry). Mitigations: patching, segmentation, IDS/IPS.</p>

        <h3>Trojan</h3>
        <p class="long-read">Disguised as legitimate software; often drops other malware (e.g., Zeus). Mitigations: app allowlists, EDR, trusted sources.</p>

        <h3>Botnet</h3>
        <p class="long-read">Network of compromised devices used for DDoS, spam or mining (e.g., Mirai). Mitigations: device hardening, network monitoring, ISP cooperation.</p>

        <h3>Keylogger</h3>
        <p class="long-read">Records keystrokes to steal credentials. Mitigations: MFA, EDR, keystroke protection.</p>

        <h3>Rootkit</h3>
        <p class="long-read">Stealthy toolkit that hides attacker presence. Mitigations: secure boot, integrity checks, reimaging infected hosts.</p>

        <h3>Spyware & Adware</h3>
        <p class="long-read">Spyware steals data quietly; adware displays unwanted ads and tracks users. Mitigations: antispyware, browser hygiene, pop-up blockers.</p>

        <h3>Ransomware</h3>
        <p class="long-read">Encrypts files and demands payment. Mitigations: immutable backups, segmentation, rapid detection and isolation.</p>

        <div class="callout">
          <strong>Defense summary:</strong> Layered defenses (EDR, patching, least privilege, backups, user training and monitoring) reduce risk and detection time.
        </div>
      </section>

      <!-- LAB / HANDS-ON -->
      <section class="card long-read" aria-labelledby="hands">
        <h2 id="hands" class="section-title">23. Hands-On Ideas & Lab Exercises</h2>
        <ul class="list">
          <li>Run a small vulnerability scan in an isolated lab to see open ports and services (Nmap + OpenVAS).</li>
          <li>Set up a host-based IDS (Wazuh/OSSEC) and generate a harmless event to see alerting.</li>
          <li>Create a simple web form and test input validation to learn about injection risks (in a sandboxed lab only).</li>
          <li>Practice creating secure cookies and explore <code>HttpOnly</code> and <code>SameSite</code> behaviour.</li>
        </ul>
        <p class="small muted">Always use isolated lab environments and written permission for live tests.</p>
      </section>

      <!-- QUIZ GATE -->
      <section class="card" aria-labelledby="quiz">
        <h2 id="quiz" class="section-title">Lesson 1 Quiz</h2>
        <p class="muted">Click <strong>Attempt Quiz</strong> when ready ‚Äî the quiz is gated so you can finish reading first. The quiz has 10 questions; incorrect answers will be highlighted with explanations.</p>

        <div style="display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap;">
          <button class="btn primary attempt-btn" id="attemptBtn">üß™ Attempt Quiz</button>
          <button class="btn ghost" id="downloadNotes">üì• Download Notes (Text)</button>
          <button class="btn" id="copyMd">üìã Copy as Markdown</button>
          <div class="meta small"><span>Estimated read time: ~30‚Äì45 mins (expanded)</span></div>
        </div>

        <!-- quiz form hidden until attempt -->
        <form id="quizForm" style="display:none;margin-top:14px;" aria-live="polite">
          <!-- Q1 -->
          <div class="q-card">
            <h4>1) What is the primary goal of cybersecurity?</h4>
            <div class="q-options">
              <label><input type="radio" name="q1" value="a"/> To make systems run faster</label>
              <label><input type="radio" name="q1" value="b"/> To protect systems, data and services from digital attacks</label>
              <label><input type="radio" name="q1" value="c"/> To replace human workers with robots</label>
            </div>
          </div>

          <!-- Q2 -->
          <div class="q-card">
            <h4>2) Which three elements form the CIA triad?</h4>
            <div class="q-options">
              <label><input type="radio" name="q2" value="a"/> Confidentiality, Integrity, Availability</label>
              <label><input type="radio" name="q2" value="b"/> Control, Identity, Access</label>
              <label><input type="radio" name="q2" value="c"/> Cookies, IPs, Authentication</label>
            </div>
          </div>

          <!-- Q3 -->
          <div class="q-card">
            <h4>3) Which statement best describes 'accountability' in security?</h4>
            <div class="q-options">
              <label><input type="radio" name="q3" value="a"/> Ensuring systems never fail</label>
              <label><input type="radio" name="q3" value="b"/> Linking actions to users so they can be evaluated</label>
              <label><input type="radio" name="q3" value="c"/> Making all data public for transparency</label>
            </div>
          </div>

          <!-- Q4 -->
          <div class="q-card">
            <h4>4) Which of these is NOT a common area in security architecture?</h4>
            <div class="q-options">
              <label><input type="radio" name="q4" value="a"/> Account creation and management</label>
              <label><input type="radio" name="q4" value="b"/> Security protocols and roles</label>
              <label><input type="radio" name="q4" value="c"/> Garden landscaping</label>
            </div>
          </div>

          <!-- Q5 -->
          <div class="q-card">
            <h4>5) Which regulation is focused on payment card security?</h4>
            <div class="q-options">
              <label><input type="radio" name="q5" value="a"/> HIPAA</label>
              <label><input type="radio" name="q5" value="b"/> PCI-DSS</label>
              <label><input type="radio" name="q5" value="c"/> GDPR</label>
            </div>
          </div>

          <!-- Q6 -->
          <div class="q-card">
            <h4>6) Which phase of ethical hacking is used to gather public information without directly contacting the target?</h4>
            <div class="q-options">
              <label><input type="radio" name="q6" value="a"/> Active footprinting</label>
              <label><input type="radio" name="q6" value="b"/> Passive footprinting</label>
              <label><input type="radio" name="q6" value="c"/> Clearing tracks</label>
            </div>
          </div>

          <!-- Q7 -->
          <div class="q-card">
            <h4>7) Which phase involves exploiting vulnerabilities to gain entry?</h4>
            <div class="q-options">
              <label><input type="radio" name="q7" value="a"/> Reconnaissance</label>
              <label><input type="radio" name="q7" value="b"/> Gaining Access (Exploitation)</label>
              <label><input type="radio" name="q7" value="c"/> Auditing</label>
            </div>
          </div>

          <!-- Q8 -->
          <div class="q-card">
            <h4>8) In the Cyber Kill Chain, which stage comes after privilege escalation?</h4>
            <div class="q-options">
              <label><input type="radio" name="q8" value="a"/> Reconnaissance</label>
              <label><input type="radio" name="q8" value="b"/> Lateral Movement</label>
              <label><input type="radio" name="q8" value="c"/> Denial of Service</label>
            </div>
          </div>

          <!-- Q9 -->
          <div class="q-card">
            <h4>9) Which malware type typically encrypts files and demands payment?</h4>
            <div class="q-options">
              <label><input type="radio" name="q9" value="a"/> Spyware</label>
              <label><input type="radio" name="q9" value="b"/> Ransomware</label>
              <label><input type="radio" name="q9" value="c"/> Adware</label>
            </div>
          </div>

          <!-- Q10 -->
          <div class="q-card">
            <h4>10) Which of these is a recommended defense approach against malware?</h4>
            <div class="q-options">
              <label><input type="radio" name="q10" value="a"/> Layered defenses: patching, backups, least privilege, and EDR</label>
              <label><input type="radio" name="q10" value="b"/> Rely on a single antivirus product only</label>
              <label><input type="radio" name="q10" value="c"/> Turning off logging to improve performance</label>
            </div>
          </div>

          <div style="display:flex;gap:10px;align-items:center;margin-top:12px;">
            <button type="button" class="btn primary" id="submitQuiz">Submit Quiz</button>
            <button type="button" class="btn" id="resetQuiz">Reset</button>
            <span id="quizResult" class="result" aria-live="polite"></span>
          </div>

        </form>
      </section>
    </article>

    <footer class="container">
      <p>¬© Learning Playground ‚Äì Cybersecurity ‚Ä¢ Lesson 1 (Expanded)</p>
    </footer>
  </main>

  <!-- Mobile floating "Lesson" button -->
  <a href="cyber-index.html" id="mobileBack" class="mobile-back" aria-label="Back to Lesson"
     style="position:fixed;left:12px;bottom:calc(16px + env(safe-area-inset-bottom));z-index:9998;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#021024;padding:8px 12px;border-radius:999px;font-weight:800;text-decoration:none;display:none">
    ‚óÄ Lesson
  </a>

  <!-- TTS Control Bar -->
  <div id="ttsBar" class="tts-bar" role="region" aria-label="Text to Speech Controls">
    <button id="ttsPlay" title="Play">‚ñ∂</button>
    <button id="ttsPause" title="Pause">‚è∏</button>
    <button id="ttsStop" title="Stop">‚èπ</button>

    <span class="small">Voice</span>
    <select id="ttsVoices" aria-label="Select voice"></select>

    <span class="small">Rate</span>
    <input id="ttsRate" type="range" min="0.6" max="2" step="0.1" value="1" />

    <span class="small">Pitch</span>
    <input id="ttsPitch" type="range" min="0.6" max="2" step="0.1" value="1" />

    <button id="ttsToggleAuto" class="small" title="Auto-read on load">A</button>
  </div>

<script>
/* ---------- tiny selectors ---------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

/* ---------- theme toggle (persist) ---------- */
(function(){
  const key='lesson1.theme';
  const btn = $('#toggleTheme');
  function apply(mode){
    if(mode==='light'){
      document.documentElement.style.setProperty('--bg','#f3f6fb');
      document.documentElement.style.setProperty('--card','#ffffff');
      document.documentElement.style.setProperty('--text','#062033');
      document.documentElement.style.setProperty('--muted','#55667a');
      document.documentElement.style.setProperty('--accent','#3b82f6');
      document.documentElement.style.setProperty('--accent2','#34d399');
    } else {
      document.documentElement.style.setProperty('--bg','#071428');
      document.documentElement.style.setProperty('--card','#0f2136');
      document.documentElement.style.setProperty('--text','#e9f6ff');
      document.documentElement.style.setProperty('--muted','#9db7d9');
      document.documentElement.style.setProperty('--accent','#57a7ff');
      document.documentElement.style.setProperty('--accent2','#7ef0c8');
    }
  }
  const saved = localStorage.getItem(key) || 'dark';
  apply(saved);
  btn.addEventListener('click', ()=>{
    const cur = localStorage.getItem(key) || 'dark';
    const next = cur==='dark' ? 'light' : 'dark';
    localStorage.setItem(key,next);
    apply(next);
  });
})();

/* ---------- Download / Copy ---------- */
$('#downloadNotes').addEventListener('click', () => {
  const nodes = document.querySelectorAll('main article h1, main article h2, main article h3, main article p, main article li, main article pre');
  const lines = [];
  nodes.forEach(n => {
    const t = n.innerText.trim();
    if (t) lines.push(t);
  });
  const blob = new Blob([lines.join('\n\n')], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'Lesson1_Notes.txt'; document.body.appendChild(a); a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 700);
});

$('#copyMd').addEventListener('click', async () => {
  const nodes = document.querySelectorAll('main article h1, main article h2, main article h3, main article p, main article li, main article pre');
  let md = '';
  nodes.forEach(n => {
    const tag = n.tagName.toLowerCase();
    const txt = n.innerText.trim();
    if (!txt) return;
    if (tag === 'h1') md += '# ' + txt + '\n\n';
    else if (tag === 'h2') md += '## ' + txt + '\n\n';
    else if (tag === 'h3') md += '### ' + txt + '\n\n';
    else if (tag === 'li') md += '- ' + txt + '\n';
    else if (tag === 'pre') md += '```\n' + txt + '\n```\n\n';
    else md += txt + '\n\n';
  });
  try { await navigator.clipboard.writeText(md); alert('Copied notes as Markdown.'); }
  catch(e){ alert('Could not copy to clipboard.'); }
});

/* ---------- Quiz gating + grading ---------- */
const attemptBtn = $('#attemptBtn');
const quizForm = $('#quizForm');
const submitQuiz = $('#submitQuiz');
const resetQuiz = $('#resetQuiz');
const quizResult = $('#quizResult');

const answers = {
  q1:{a:false,b:true,c:false,explain:'Protect systems, data and services from digital attacks.'},
  q2:{a:true,b:false,c:false,explain:'Confidentiality, Integrity, Availability.'},
  q3:{a:false,b:true,c:false,explain:'Link actions to users so they can be evaluated.'},
  q4:{a:false,b:false,c:true,explain:'Garden landscaping is not part of security architecture.'},
  q5:{a:false,b:true,c:false,explain:'PCI-DSS focuses on payment card security.'},
  q6:{a:false,b:true,c:false,explain:'Passive footprinting gathers public info without contacting target.'},
  q7:{a:false,b:true,c:false,explain:'Gaining Access (Exploitation) is that phase.'},
  q8:{a:false,b:true,c:false,explain:'Lateral Movement typically follows privilege escalation.'},
  q9:{a:false,b:true,c:false,explain:'Ransomware encrypts files and demands payment.'},
  q10:{a:true,b:false,c:false,explain:'Layered defenses are recommended.'}
};

attemptBtn.addEventListener('click', ()=>{
  attemptBtn.disabled = true;
  quizForm.style.display = 'block';
  quizForm.scrollIntoView({behavior:'smooth', block:'center'});
});

submitQuiz.addEventListener('click', ()=>{
  let score=0; const parts=[];
  for(let i=1;i<=10;i++){
    const q='q'+i;
    const sel = document.querySelector(`input[name="${q}"]:checked`);
    const user = sel ? sel.value : '(no answer)';
    const isCorrect = sel && answers[q][sel.value] === true;
    if(isCorrect) score++;
    parts.push(`<strong>Q${i}</strong> ‚Äî Your answer: ${user} ‚Äî ${isCorrect?'<span style="color:var(--ok)">Correct</span>':'<span style="color:var(--danger)">Incorrect</span>'}<br><em>Explanation:</em> ${answers[q].explain}`);
  }
  quizResult.innerHTML = `<div><strong>Score:</strong> ${score} / 10</div><div style="margin-top:10px">${parts.join('<hr>')}</div>`;
  quizResult.scrollIntoView({behavior:'smooth', block:'center'});
});

resetQuiz.addEventListener('click', ()=>{
  quizForm.reset(); quizForm.style.display='none'; quizResult.innerHTML=''; attemptBtn.disabled=false; attemptBtn.scrollIntoView({behavior:'smooth'});
});

/* ---------- mobile back toggle ---------- */
(function(){
  const mb = $('#mobileBack'), desktopBack = $('#backLink');
  function update(){ const small = window.matchMedia('(max-width:600px)').matches; mb.style.display = small ? 'inline-flex' : 'none'; desktopBack.style.display = small ? 'none' : 'inline-flex'; }
  update(); window.addEventListener('resize', update);
})();

/* ---------- TTS module (responsive & robust) ---------- */
(function(){
  const bar = document.getElementById('ttsBar');
  if(!bar) return;
  if(!('speechSynthesis' in window)){ bar.style.display='none'; adjustForTTS(); return; }

  const play = $('#ttsPlay'), pause = $('#ttsPause'), stop = $('#ttsStop');
  const voicesSelect = $('#ttsVoices'), rateInput = $('#ttsRate'), pitchInput = $('#ttsPitch'), autoBtn = $('#ttsToggleAuto');
  const lessonRoot = document.querySelector('.lesson-content');

  let voices = [];
  function populateVoices(){
    voices = speechSynthesis.getVoices();
    voicesSelect.innerHTML = '';
    voices.forEach(v=>{
      const o = document.createElement('option'); o.value = v.voiceURI || v.name; o.textContent = `${v.name} (${v.lang})${v.default? ' ‚Äî default':''}`; voicesSelect.appendChild(o);
    });
    const saved = localStorage.getItem('lesson1.voice');
    if(saved && Array.from(voicesSelect.options).some(o=>o.value===saved)) voicesSelect.value = saved;
  }
  populateVoices();
  if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = populateVoices;

  function getTextForTTS(){
    // gather headings, paragraphs, list items and pre blocks
    const nodes = lessonRoot.querySelectorAll('h1,h2,h3,p,li,pre');
    return Array.from(nodes).map(n=>n.innerText.trim()).filter(Boolean).join('.\n');
  }

  // remove marks cleanly
  function removeAllMarks(){
    const marks = lessonRoot.querySelectorAll('mark.tts-mark');
    marks.forEach(m=>{
      const parent = m.parentNode;
      while(m.firstChild) parent.insertBefore(m.firstChild, m);
      parent.removeChild(m);
      parent.normalize();
    });
  }

  // find and mark sentence using text nodes and Range
  function findAndMarkSentence(sentence){
    if(!sentence) return;
    const textNodes = (function getTextNodes(root){
      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, { acceptNode: node => {
        if(!node.nodeValue.trim()) return NodeFilter.FILTER_REJECT;
        const p = node.parentElement;
        if(!p) return NodeFilter.FILTER_REJECT;
        const hidden = ['SCRIPT','STYLE','NOSCRIPT','SELECT','OPTION','INPUT','BUTTON','TEXTAREA','LABEL'];
        if(hidden.includes(p.tagName)) return NodeFilter.FILTER_REJECT;
        return NodeFilter.FILTER_ACCEPT;
      }}, false);
      const arr=[]; let n; while(n = walker.nextNode()) arr.push(n); return arr;
    })(lessonRoot);

    for(const node of textNodes){
      const idx = node.nodeValue.indexOf(sentence);
      if(idx >= 0){
        try{
          const range = document.createRange();
          range.setStart(node, idx);
          range.setEnd(node, idx + sentence.length);
          // surroundContents can throw if range splits multiple elements ‚Äî but we are inside single text node, OK
          const mark = document.createElement('mark'); mark.className = 'tts-mark';
          range.surroundContents(mark);
          mark.scrollIntoView({behavior:'smooth', block:'center'});
        }catch(e){ /* ignore */ }
        return;
      }
    }
  }

  let playing=false, currentUtter=null;

  function speakAll(){
    stopAll();
    const raw = getTextForTTS();
    if(!raw) return;
    const sentences = raw.split(/(?<=[.?!])\s+/);
    let i=0; playing=true;
    function speakNext(){
      if(!playing) return;
      if(i >= sentences.length){ playing=false; removeAllMarks(); return; }
      const s = sentences[i++].trim();
      if(!s) return speakNext();
      const u = new SpeechSynthesisUtterance(s);
      const selURI = voicesSelect.value || localStorage.getItem('lesson1.voice') || '';
      const sel = voices.find(v=>v.voiceURI===selURI) || voices.find(v=>v.default) || voices[0];
      if(sel) u.voice = sel;
      u.rate = parseFloat(rateInput.value || 1);
      u.pitch = parseFloat(pitchInput.value || 1);
      u.onstart = ()=> { try { findAndMarkSentence(s); } catch(e){} };
      u.onend = ()=> { removeAllMarks(); setTimeout(()=> speakNext(), 90); };
      speechSynthesis.speak(u);
      currentUtter = u;
    }
    speakNext();
  }

  function stopAll(){ playing=false; if(speechSynthesis.speaking || speechSynthesis.pending) speechSynthesis.cancel(); removeAllMarks(); }
  function pauseAll(){ if(speechSynthesis.speaking) speechSynthesis.pause(); else if(speechSynthesis.paused) speechSynthesis.resume(); }

  play.addEventListener('click', ()=> {
    if(speechSynthesis.paused) return speechSynthesis.resume();
    if(speechSynthesis.speaking) return;
    speakAll();
    localStorage.setItem('lesson1.voice', voicesSelect.value || '');
    localStorage.setItem('lesson1.rate', rateInput.value);
    localStorage.setItem('lesson1.pitch', pitchInput.value);
  });
  pause.addEventListener('click', pauseAll);
  stop.addEventListener('click', stopAll);

  voicesSelect.addEventListener('change', ()=> localStorage.setItem('lesson1.voice', voicesSelect.value || ''));
  rateInput.addEventListener('change', ()=> localStorage.setItem('lesson1.rate', rateInput.value));
  pitchInput.addEventListener('change', ()=> localStorage.setItem('lesson1.pitch', pitchInput.value));

  // auto toggle
  const savedAuto = localStorage.getItem('lesson1.auto') === 'true';
  autoBtn.style.opacity = savedAuto ? '1' : '0.6';
  autoBtn.addEventListener('click', ()=> {
    const cur = localStorage.getItem('lesson1.auto') === 'true';
    localStorage.setItem('lesson1.auto', (!cur).toString());
    autoBtn.style.opacity = (!cur) ? '1' : '0.6';
  });

  // apply saved settings and maybe autoplay
  function applySaved(){
    const sv = localStorage.getItem('lesson1.voice');
    if(sv && Array.from(voicesSelect.options).some(o=>o.value===sv)) voicesSelect.value = sv;
    const sr = localStorage.getItem('lesson1.rate'); if(sr) rateInput.value = sr;
    const sp = localStorage.getItem('lesson1.pitch'); if(sp) pitchInput.value = sp;
    if(localStorage.getItem('lesson1.auto') === 'true'){ try{ speakAll(); } catch(e){ console.warn('Auto TTS blocked',e); } }
  }

  let tries=0;
  const iv=setInterval(()=> {
    if(speechSynthesis.getVoices().length){ populateVoices(); applySaved(); clearInterval(iv); adjustForTTS(); }
    else if(++tries>30){ applySaved(); clearInterval(iv); adjustForTTS(); }
  }, 200);

  // observe and adjust height
  const ro = new ResizeObserver(entries => adjustForTTS());
  ro.observe(bar);
  setTimeout(adjustForTTS, 300);
})(); // end TTS

/* ---------- adjust for TTS bar so anchors not covered ---------- */
function adjustForTTS(){
  const bar = document.getElementById('ttsBar');
  if(!bar) return;
  const rect = bar.getBoundingClientRect();
  const cs = window.getComputedStyle(bar);
  const h = Math.ceil(rect.height + parseFloat(cs.marginTop||0) + parseFloat(cs.marginBottom||0));
  document.documentElement.style.setProperty('--tts-height', h + 'px');
  document.querySelectorAll('.container').forEach(c => c.style.paddingBottom = (28 + h) + 'px');
}
window.addEventListener('load', ()=> setTimeout(adjustForTTS, 300));
window.addEventListener('resize', ()=> setTimeout(adjustForTTS, 120));

/* ---------- keyboard shortcuts ---------- */
window.addEventListener('keydown', (e)=>{
  const tag = (e.target && e.target.tagName || '').toLowerCase();
  if(tag === 'input' || tag === 'textarea' || e.target.isContentEditable) return;
  if(e.code === 'Space'){ e.preventDefault(); const synth = window.speechSynthesis; if(synth.speaking && !synth.paused) document.getElementById('ttsPause').click(); else if(synth.paused) document.getElementById('ttsPause').click(); else document.getElementById('ttsPlay').click(); }
  else if(e.key.toLowerCase() === 's') document.getElementById('ttsStop').click();
  else if(e.key.toLowerCase() === 'b') window.location.href = 'cyber-index.html';
  else if(e.key.toLowerCase() === 'a') document.getElementById('ttsToggleAuto').click();
  else if(e.key === '+' || e.key === '='){ const r = document.getElementById('ttsRate'); r.value = Math.min(parseFloat(r.value)+0.1, parseFloat(r.max)); r.dispatchEvent(new Event('change')); }
  else if(e.key === '-') { const r = document.getElementById('ttsRate'); r.value = Math.max(parseFloat(r.value)-0.1, parseFloat(r.min)); r.dispatchEvent(new Event('change')); }
});

/* ---------- console hint ---------- */
if(!localStorage.getItem('lesson1.hint')){ console.info('TTS shortcuts: Space play/pause ‚Ä¢ S stop ‚Ä¢ B back ‚Ä¢ A toggle auto ‚Ä¢ +/- rate'); localStorage.setItem('lesson1.hint','1'); }
</script>
</body>
</html>
