<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lesson 2 – Introduction to Linux (Comprehensive + Labs + TTS)</title>

  <style>
    :root {
      --bg: #0b1220;
      --card: #111a2e;
      --muted: #8aa0c3;
      --text: #e7eefc;
      --accent: #6ea8ff;
      --accent-2: #7ef0c1;
      --warning: #ffdf6e;
      --danger: #ff7e93;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Noto Sans,Helvetica,Arial}
    body{color:var(--text); background:linear-gradient(135deg,#0b1220 0%,#101b34 100%); -webkit-font-smoothing:antialiased;}
    .container{max-width:1200px;margin:0 auto;padding:18px}
    header{position:sticky;top:0;z-index:40;backdrop-filter:saturate(160%) blur(8px);background:rgba(11,18,32,0.75);border-bottom:1px solid rgba(255,255,255,0.04)}
    .header-row{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px}
    .badge{display:inline-flex;align-items:center;gap:8px;font-weight:600;color:#0b1220;background:linear-gradient(135deg,var(--accent),var(--accent-2));padding:8px 12px;border-radius:999px;font-size:12px;text-transform:uppercase;letter-spacing:.06em}
    .hero{padding:22px 20px 12px}
    .title{font-size:clamp(26px,4vw,44px);line-height:1.08;margin:4px 0 10px}
    .subtitle{color:var(--muted);font-size:15px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{padding:6px 10px;background:var(--glass);border-radius:999px;font-size:12px;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}
    .card{background:radial-gradient(140% 120% at 100% 0%,#132349 0%,var(--card) 45%);border:1px solid rgba(255,255,255,0.04);border-radius:14px;padding:18px;box-shadow:0 12px 40px rgba(0,0,0,.35);margin-top:16px}
    .list{margin:0;padding-left:18px}
    .list li{margin:8px 0}
    .callout{background:linear-gradient(180deg,rgba(126,240,193,.06),rgba(126,240,193,.02));border:1px solid rgba(126,240,193,.12);padding:12px 14px;border-radius:12px;margin-top:10px}
    .warn{background:linear-gradient(180deg,rgba(255,223,110,.06),rgba(255,223,110,.02));border:1px solid rgba(255,223,110,.12)}
    .video-wrap{position:relative;overflow:hidden;border-radius:12px;aspect-ratio:16/9;background:#0b1220;border:1px solid rgba(255,255,255,.04);display:flex;align-items:center;justify-content:center;color:var(--muted)}
    .subtitle small{display:block;color:var(--muted);margin-top:6px}
    .q-card{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.04);border-radius:12px;padding:12px;margin:10px 0}
    .q-options{display:grid;gap:8px;margin-top:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.08);color:var(--text);padding:10px 14px;border-radius:12px;background:rgba(255,255,255,.03);cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#0b1220;border:none}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.03)}
    .result{font-size:18px;font-weight:700}
    .good{color:var(--accent-2)}
    .mid{color:var(--warning)}
    .bad{color:var(--danger)}
    footer{opacity:.8;font-size:13px;padding:30px 0 60px}
    .section-title{margin:0 0 8px}
    .muted{color:var(--muted)}
    pre{white-space:pre-wrap;background:rgba(0,0,0,0.15);padding:12px;border-radius:8px;overflow:auto}
    .meta{display:flex;gap:8px;flex-wrap:wrap}
    .attempt-btn{margin-top:12px}
    .long-read{line-height:1.75;font-size:15px}
    .small{font-size:13px;color:var(--muted)}
    .explain{margin-top:8px;background:rgba(0,0,0,0.12);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
    .kbd{background:rgba(255,255,255,0.03);padding:2px 6px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);font-family:monospace}
    .two-col{display:grid;grid-template-columns:1fr 420px;gap:18px}
    @media (max-width:980px){.two-col{grid-template-columns:1fr}}
    .sidebar .card{position:sticky;top:84px}
    .faq dt{font-weight:700;margin-top:12px}
    .glossary dt{font-weight:700;margin-top:8px}
    /* TTS control bar */
    .tts-bar {
      position: fixed;
      right: 18px;
      bottom: 18px;
      z-index: 9999;
      background: rgba(0,0,0,0.65);
      color: #00ffcc;
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.6);
      font-family: 'Share Tech Mono', monospace;
      display: flex;
      gap: 8px;
      align-items: center;
      backdrop-filter: blur(6px);
      min-width: 320px;
    }
    .tts-bar button { background: linear-gradient(45deg,#ff0080,#7928ca); border: none; color: #fff; padding: 8px 10px; border-radius: 8px; font-weight: 700; cursor: pointer; min-width: 44px; }
    .tts-bar button.small { padding: 6px 8px; min-width: 36px; font-size: 0.95rem; }
    .tts-bar select, .tts-bar input[type="range"] { background: rgba(255,255,255,0.06); color: #00ffcc; border: 1px solid rgba(255,255,255,0.06); padding: 6px; border-radius: 8px; font-family: inherit; }
    .tts-bar .label { font-size: 0.82rem; opacity: 0.95; margin-right: 6px; white-space: nowrap; }
    .tts-highlight { background: rgba(0,255,200,0.15); transition: background 0.2s; padding: 0 2px; border-radius: 3px; }
    @media (max-width:600px) { .tts-bar { left: 50%; transform: translateX(-50%); right: auto; bottom: 12px; min-width: 88%; } }
  </style>
</head>
<body>
  <header>
    <div class="container header-row">
      <div style="display:flex;align-items:center;gap:12px">
        <span class="badge">Lesson 2</span>
        <div>
          <strong>Introduction to Linux — Comprehensive Module</strong>
          <div class="small muted">Kernel, distributions, CLI, editors, networking, security, labs, cheat-sheets, TTS and quizzes.</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn ghost" id="toggleTheme" title="Toggle contrast">🌗 Theme</button>
        <button class="btn" id="downloadNotes">📥 Download Notes</button>
        <button class="btn primary" id="copyMarkdown">📋 Copy Markdown</button>
      </div>
    </div>
  </header>

  <main class="container two-col">
    <article>
      <section class="hero card">
        <h1 class="title">Introduction to Linux — Deep Dive</h1>
        <p class="subtitle">A thorough, practical lesson covering fundamentals, internals, administration tasks, networking, security hardening, and multiple hands-on labs for learners at beginner to intermediate levels.</p>
        <div class="chips">
          <span class="chip">Kernel internals</span>
          <span class="chip">Shell & scripting</span>
          <span class="chip">Editors</span>
          <span class="chip">Package management</span>
          <span class="chip">Networking</span>
        </div>
      </section>

      <!-- Extensive content -->
      <section class="card long-read" id="overview">
        <h2 class="section-title">Module overview</h2>
        <p>This module is intentionally comprehensive. It begins with core concepts (what an OS is, what Linux is), moves into architecture and kernel topics, then covers the command-line and essential tools, finishes with real-world labs and security best-practices, and provides a cheat-sheet plus a glossary for quick reference.</p>

        <h3>Learning goals</h3>
        <ul class="list">
          <li>Understand Linux system components and architecture.</li>
          <li>Use the shell fluently to manage files, processes and services.</li>
          <li>Configure basic networking and diagnose common issues.</li>
          <li>Create and run scripts to automate tasks.</li>
          <li>Harden a basic server and understand detection/response steps for incidents.</li>
          <li>Build safe lab practices to test tools and scenarios.</li>
        </ul>
      </section>

      <section class="card long-read" id="osbasics">
        <h2 class="section-title">1 — Operating system fundamentals (expanded)</h2>
        <p>An operating system mediates access to hardware and provides essential abstractions: processes, threads, files, and device I/O. Linux follows classical Unix design principles with small composable tools and a strong textual configuration model.</p>

        <h3>Processes and threads</h3>
        <p>Processes are isolated execution contexts with private virtual memory; threads are execution paths within a process sharing memory. The kernel scheduler assigns CPU time using priorities and fairness heuristics, and modern kernels support multi-core scheduling (SMP).</p>

        <h3>Memory management details</h3>
        <p>Linux uses virtual memory with page tables, and employs demand paging. Swap space allows the kernel to offload inactive pages to disk under memory pressure. Techniques like copy-on-write (fork/exec) improve efficiency for duplicated processes.</p>

        <h3>Filesystems and persistence</h3>
        <p>Linux supports many filesystems: ext4 (stable general-purpose), XFS (large files/throughput), btrfs (copy-on-write snapshots), and ZFS (advanced features). Mount options, fstab, and UUIDs control how volumes attach at boot. Understanding FS mounting, permissions, and journaling properties is essential for admins.</p>

        <div class="explain">
          <strong>Admin tip:</strong> Always test backups and snapshot restore workflows — backups that haven't been validated can be worthless in a crisis.
        </div>
      </section>

      <section class="card long-read" id="kernelinternals">
        <h2 class="section-title">2 — Kernel internals & modules</h2>
        <p>The Linux kernel includes subsystems: process scheduler, VFS (virtual filesystem), network stack, memory manager, and driver framework. Kernel modules allow drivers and features to be loaded/unloaded at runtime.</p>

        <h3>Practical module commands</h3>
        <pre>
# List loaded kernel modules
lsmod

# Get module details
modinfo <module_name>

# Load and unload
sudo modprobe <module_name>
sudo modprobe -r <module_name>
        </pre>

        <h3>Sysctl tuning</h3>
        <p>Use <code>sysctl</code> to adjust kernel parameters at runtime (e.g., networking buffers, swappiness).</p>
        <pre>
# View a parameter
sysctl net.ipv4.ip_forward

# Temporarily change
sudo sysctl -w net.ipv4.ip_forward=1

# Persist in /etc/sysctl.conf
echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf
        </pre>

        <div class="explain small muted">Careful: kernel tuning affects system stability; test changes in staging first.</div>
      </section>

      <section class="card long-read" id="userland">
        <h2 class="section-title">3 — Userland: shells, utilities, init systems</h2>
        <h3>Shells</h3>
        <p>Bash is the ubiquitous shell — learn scripting basics: variables, conditionals, loops, functions and I/O redirection. Zsh offers more features and ergonomics; Fish targets a friendlier UX.</p>

        <h3>Init and service managers</h3>
        <p>Most modern distributions use systemd which manages services, sockets, and mounts. Important systemd commands:</p>
        <pre>
# Check status of a service
sudo systemctl status nginx

# Start/stop/restart
sudo systemctl start|stop|restart nginx

# Enable at boot
sudo systemctl enable nginx
        </pre>

        <h3>System logs</h3>
        <p>Journalctl reads systemd logs. Traditional logs in /var/log are still used by some services (e.g., Apache).</p>
        <pre>
# Show recent system logs
sudo journalctl -n 200 --no-pager

# Follow logs in real-time
sudo journalctl -f -u ssh
        </pre>
      </section>

      <section class="card long-read" id="fileperm">
        <h2 class="section-title">4 — Files, permissions and ACLs</h2>
        <p>Unix permissions are triads: owner, group, others with read/write/execute bits. Use <code>chmod</code>, <code>chown</code>, and <code>chgrp</code> to manage them. For more granular control, use POSIX ACLs via <code>getfacl</code>/<code>setfacl</code>.</p>
        <pre>
# Show permissions
ls -la /etc/passwd

# Change owner
sudo chown root:root /opt/myapp

# Set ACL for a user
sudo setfacl -m u:alice:rwx /srv/shared
        </pre>
        <div class="explain">Remember: granting write access to unknown users is a common security mistake. Apply least privilege.</div>
      </section>

      <section class="card long-read" id="processes">
        <h2 class="section-title">5 — Processes, jobs and scheduling</h2>
        <p>Use <code>ps</code>, <code>top</code>, <code>htop</code>, and <code>nice</code>/<code>renice</code> to view and manage processes. Background jobs are controlled with <code>&</code>, <code>fg</code>, and <code>bg</code>.</p>
        <pre>
# List all processes
ps aux | less

# Interactive top-like monitor
htop

# Set scheduler niceness
sudo nice -n 10 /usr/bin/longtask
        </pre>
        <div class="explain">Troubleshoot high CPU or memory by checking process trees and open files (see <code>lsof</code>).</div>
      </section>

      <section class="card long-read" id="networking">
        <h2 class="section-title">6 — Networking fundamentals</h2>
        <p>Key commands: <code>ip</code> replaces older <code>ifconfig</code>. Manage routes, interfaces and examine open sockets.</p>
        <pre>
# Show interfaces
ip a

# Show routing table
ip route

# Check listening ports
ss -tuln
        </pre>

        <h3>DNS & resolution</h3>
        <p>Check <code>/etc/resolv.conf</code>, use <code>dig</code> or <code>nslookup</code> for diagnostics.</p>

        <h3>Firewall</h3>
        <p>Use nftables (modern) or iptables. Example nftables snippet:</p>
        <pre>
sudo nft add table inet myfilter
sudo nft add chain inet myfilter input { type filter hook input priority 0 \; }
sudo nft add rule inet myfilter input tcp dport 22 accept
        </pre>
      </section>

      <section class="card long-read" id="package">
        <h2 class="section-title">7 — Package management</h2>
        <p>Package managers install, update and remove software. Example commands for apt (Debian/Ubuntu) and dnf (Fedora):</p>
        <pre>
# Debian / Ubuntu
sudo apt update
sudo apt install nginx
sudo apt upgrade

# Fedora / RHEL
sudo dnf update
sudo dnf install httpd
        </pre>
        <div class="explain small muted">Use package signing and official repositories to reduce supply-chain risks. Consider tools like apt pinning or repo proxies for enterprise control.</div>
      </section>

      <section class="card long-read" id="scripting">
        <h2 class="section-title">8 — Shell scripting fundamentals</h2>
        <p>Basic script structure with safety checks and logging:</p>
        <pre>
#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

log() { echo "$(date --iso-8601=seconds) - $*"; }

main() {
  log "Starting job"
  # your commands here
  log "Done"
}

main "$@"
        </pre>
        <div class="explain">Use <code>set -euo pipefail</code> to reduce silent failures and make your scripts robust. For complex automation, consider Python or Ansible.</div>
      </section>

      <section class="card long-read" id="security">
        <h2 class="section-title">9 — Basic Linux security & hardening</h2>
        <p>Security is layered: network controls, host hardening, identity & access management, monitoring and incident response.</p>

        <h3>Quick hardening checklist</h3>
        <ul class="list">
          <li>Keep packages updated and enable unattended security updates where appropriate.</li>
          <li>Use SSH keys and disable password auth for SSH for admin accounts: <code>/etc/ssh/sshd_config</code>.</li>
          <li>Disable or firewall off unnecessary services.</li>
          <li>Install and configure auditd and centralized logging/monitoring (ELK/Graylog/Datadog).</li>
          <li>Enable SELinux or AppArmor where available and enforce policies.</li>
          <li>Use disk encryption (LUKS) for sensitive hosts and backups.</li>
        </ul>

        <h3>Detecting compromise</h3>
        <p>Watch for: unexpected processes, unusual network connections, new user accounts, modified binaries, unexpected scheduled jobs, and changes to firewall rules. EDR/OSQuery/Velociraptor are useful for endpoint detection.</p>
      </section>

      <section class="card long-read" id="backups">
        <h2 class="section-title">10 — Backups and recovery</h2>
        <p>Backups are a core part of reliability and security. Use multiple retention points, test restores regularly, and keep copies offline or immutable to withstand ransomware.</p>
        <pre>
# Simple tar-based backup
tar -czvf /backup/home-$(date +%F).tar.gz /home

# Use rsync for remote backups
rsync -avz /srv/data backup@backupserver:/backups/
        </pre>
        <div class="explain">Consider dedicated backup software (Borg, Restic, Duplicity) which support deduplication and encryption.</div>
      </section>

      <section class="card long-read" id="labs">
        <h2 class="section-title">11 — Hands-on labs (step-by-step)</h2>

        <h3>Lab A — Create a VM and install Ubuntu Server</h3>
        <ol class="list">
          <li>Download the Ubuntu Server ISO and create a VM (VirtualBox / VMware / QEMU).</li>
          <li>Allocate at least 2GB RAM and 20GB disk for practice.</li>
          <li>Install SSH server during setup to enable remote access.</li>
          <li>After boot, create a non-root user and enable sudo.</li>
        </ol>

        <h3>Lab B — Build a simple web server</h3>
        <ol class="list">
          <li>Install Nginx: <code>sudo apt install nginx</code>.</li>
          <li>Place a test file in <code>/var/www/html/index.html</code> and reload service.</li>
          <li>Check with <code>curl http://localhost</code> from the VM and from the host (adjust firewall).</li>
        </ol>

        <h3>Lab C — Basic monitoring pipeline</h3>
        <ol class="list">
          <li>Install Filebeat or collectd to ship logs to an ELK/Opensearch stack (local or cloud trial).</li>
          <li>Create a small dashboard showing CPU, memory, and nginx access logs.</li>
        </ol>

        <div class="explain small-muted">All labs should be run in isolated networks or VMs. Take snapshots before trying risky commands and keep notes of steps performed.</div>
      </section>

      <section class="card long-read" id="troubleshooting">
        <h2 class="section-title">12 — Troubleshooting recipes</h2>
        <p>Common problems and how to triage:</p>
        <ul class="list">
          <li><strong>High CPU:</strong> use <code>top</code> or <code>htop</code> to find culprit processes; check process tree <code>pstree -p</code>.</li>
          <li><strong>Disk full:</strong> <code>df -h</code> then <code>du -sh *</code> to find large directories; check <code>/var/log</code>.</li>
          <li><strong>Service failing to start:</strong> check <code>sudo journalctl -u servicename -b</code> and <code>systemctl status servicename</code>.</li>
          <li><strong>Network unreachable:</strong> verify <code>ip a</code>, <code>ip route</code>, and test with <code>ping</code> and <code>traceroute</code>.</li>
        </ul>
      </section>

      <section class="card long-read" id="faq">
        <h2 class="section-title">13 — FAQ & common pitfalls</h2>
        <dl class="faq">
          <dt>Q: Should I use sudo or su?</dt>
          <dd>A: Prefer sudo for single commands to limit root shell exposure. Use <code>sudo -i</code> if you need a persistent root environment.</dd>

          <dt>Q: How to safely edit system files?</dt>
          <dd>A: Use <code>sudo cp /etc/file /etc/file.bak</code> before editing. Use editors like vim or nano and validate syntax (e.g., <code>sshd -t</code> after updating sshd_config).</dd>

          <dt>Q: Is Linux hard to learn?</dt>
          <dd>A: It has a learning curve, but learning the core commands and patterns unlocks powerful automation and troubleshooting skills. Start with simple tasks and build up.</dd>
        </dl>
      </section>

      <section class="card long-read" id="glossary">
        <h2 class="section-title">14 — Glossary (quick reference)</h2>
        <dl class="glossary">
          <dt>Kernel</dt><dd>Core part of the OS that manages hardware and system resources.</dd>
          <dt>Daemon</dt><dd>Background service process (e.g., sshd, cron).</dd>
          <dt>Package manager</dt><dd>Tool to install/remove/update software (apt, dnf, pacman).</dd>
          <dt>Process</dt><dd>Running instance of a program with its own memory space.</dd>
          <dt>Mount</dt><dd>Attach filesystem to the directory tree (mount point).</dd>
        </dl>
      </section>

      <section class="card long-read" id="cheatsheet">
        <h2 class="section-title">15 — Cheat sheet (quick commands)</h2>
        <pre>
# Files & Navigation
ls -la
cd /path/to/dir
pwd

# File ops
cp src dst
mv src dst
rm -i file

# Permissions & ownership
chmod 644 file
chown user:group file

# Processes
ps aux | grep app
top
htop

# Networking
ip a
ss -tuln
ping 8.8.8.8
traceroute example.com

# Systemd & logs
sudo systemctl status nginx
sudo journalctl -u nginx -f

# Disk
df -h
du -sh /var/log/*

# Archival & backup
tar -czvf backup.tgz folder/
rsync -avz /srv/data backup:/backups/

# Scripting
#!/usr/bin/env bash
set -euo pipefail

# Package (Debian)
sudo apt update && sudo apt install <package>
        </pre>
      </section>

      <section class="card long-read" id="advanced">
        <h2 class="section-title">16 — Advanced topics (paths to continue)</h2>
        <p>Once comfortable with basics, explore:</p>
        <ul class="list">
          <li>Containers & orchestration: Docker, Podman, Kubernetes.</li>
          <li>Infrastructure as Code: Terraform, Ansible.</li>
          <li>Kernel tuning & eBPF for observability (bcc, bpftrace).</li>
          <li>Security engineering: SELinux/AppArmor policies, OS hardening guides, threat hunting.</li>
          <li>Performance: profiling CPU/memory I/O (perf, iostat, pidstat).</li>
        </ul>
        <div class="explain">These areas are deep — pick one and build a project (e.g., deploy a containerized web app with CI/CD pipeline) to learn holistically.</div>
      </section>

      <section class="card long-read" id="closing">
        <h2 class="section-title">17 — Final notes & next steps</h2>
        <p>Practice is the fastest path to mastery. Build small projects: host a static site, automate backups, or create monitoring dashboards. Keep notes of commands and failures — they become your personal reference.</p>
        <div class="explain">If you want, export the markdown copy (button above) and import into your learning notes or LMS.</div>
      </section>

    </article>

    <aside class="sidebar">
      <div class="card">
        <h3>Quick Links</h3>
        <ul class="list">
          <li><a href="#overview">Module overview</a></li>
          <li><a href="#osbasics">OS fundamentals</a></li>
          <li><a href="#kernelinternals">Kernel internals</a></li>
          <li><a href="#userland">Shell & systemd</a></li>
          <li><a href="#networking">Networking</a></li>
          <li><a href="#labs">Hands-on labs</a></li>
          <li><a href="#cheatsheet">Cheat sheet</a></li>
          <li><a href="#advanced">Advanced topics</a></li>
        </ul>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Mini Quiz (self-check — 10 Q)</h3>
        <div class="q-card">
          <h4>1) Which command shows currently listening TCP ports?</h4>
          <div class="q-options">
            <label><input type="radio" name="mq1" value="a"> ss -tuln</label>
            <label><input type="radio" name="mq1" value="b"> ls -la</label>
            <label><input type="radio" name="mq1" value="c"> top</label>
          </div>
        </div>

        <div class="q-card">
          <h4>2) Which file controls systemd units autostart at boot?</h4>
          <div class="q-options">
            <label><input type="radio" name="mq2" value="a"> /etc/fstab</label>
            <label><input type="radio" name="mq2" value="b"> /etc/systemd/system</label>
            <label><input type="radio" name="mq2" value="c"> /var/log</label>
          </div>
        </div>

        <div style="display:flex;gap:8px">
          <button class="btn primary" id="gradeMini">Grade Mini Quiz</button>
          <button class="btn" id="resetMini">Reset</button>
        </div>

        <div id="miniResult" style="margin-top:12px" class="small muted"></div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Lab safety reminder</h3>
        <p class="small muted">Always run experiments on non-production systems with snapshots enabled. Never test malware or intrusive network scans on networks you do not own or have written permission to test.</p>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Glossary (mini)</h3>
        <ul class="list">
          <li><strong>SSH:</strong> Secure Shell, remote command execution protocol.</li>
          <li><strong>MFA:</strong> Multi-factor authentication — strongly recommended for admin accounts.</li>
          <li><strong>EDR:</strong> Endpoint detection and response tools for threat detection.</li>
        </ul>
      </div>
    </aside>
  </main>

  <footer class="container">
    <p class="small muted">© Learning Playground — Linux Module • Use for training and authorized labs only</p>
  </footer>

  <!-- TTS Control Bar -->
  <div id="ttsBar" class="tts-bar" role="region" aria-label="Text to Speech Controls">
    <button id="ttsPlay" title="Play">▶</button>
    <button id="ttsPause" class="small" title="Pause">⏸</button>
    <button id="ttsStop" class="small" title="Stop">⏹</button>

    <span class="label">Voice</span>
    <select id="ttsVoices" aria-label="Select voice"></select>

    <span class="label">Rate</span>
    <input id="ttsRate" type="range" min="0.6" max="2" step="0.1" value="1" />

    <span class="label">Pitch</span>
    <input id="ttsPitch" type="range" min="0.6" max="2" step="0.1" value="1" />

    <button id="ttsToggleAuto" class="small" title="Auto-read on load">A</button>
  </div>

  <script>
    /* Theme toggle */
    const themeBtn = document.getElementById('toggleTheme');
    const themeKey = 'lesson2-theme';
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const applyTheme = (mode) => {
      if (mode === 'light') {
        document.documentElement.style.setProperty('--bg','#f7f9ff');
        document.documentElement.style.setProperty('--card','#ffffff');
        document.documentElement.style.setProperty('--text','#0b1220');
        document.documentElement.style.setProperty('--muted','#4a5875');
        document.documentElement.style.setProperty('--glass','rgba(0,0,0,0.03)');
      } else {
        document.documentElement.style.setProperty('--bg','#0b1220');
        document.documentElement.style.setProperty('--card','#111a2e');
        document.documentElement.style.setProperty('--text','#e7eefc');
        document.documentElement.style.setProperty('--muted','#8aa0c3');
        document.documentElement.style.setProperty('--glass','rgba(255,255,255,0.03)');
      }
    };
    const stored = localStorage.getItem(themeKey) || (prefersDark ? 'dark' : 'dark');
    applyTheme(stored);
    themeBtn.addEventListener('click', () => {
      const cur = localStorage.getItem(themeKey) || stored;
      const next = cur === 'dark' ? 'light' : 'dark';
      localStorage.setItem(themeKey, next);
      applyTheme(next);
    });

    /* Download notes as text */
    document.getElementById('downloadNotes').addEventListener('click', () => {
      const nodes = document.querySelectorAll('article h1, article h2, article h3, article p, article li');
      const lines = [];
      nodes.forEach(n => {
        const tag = n.tagName.toLowerCase();
        const text = n.innerText.trim();
        if (!text) return;
        if (tag === 'h1') lines.push('\n' + text + '\n' + '='.repeat(60));
        else if (tag === 'h2') lines.push('\n' + text + '\n' + '-'.repeat(60));
        else lines.push(text);
      });
      const blob = new Blob([lines.join('\n')], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'Lesson2_Linux_Expanded_Notes.txt'; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 800);
    });

    /* Copy Markdown */
    document.getElementById('copyMarkdown').addEventListener('click', async () => {
      const nodes = document.querySelectorAll('article h1, article h2, article h3, article p, article li');
      let md = '';
      nodes.forEach(n => {
        const tag = n.tagName.toLowerCase();
        const txt = n.innerText.trim();
        if (!txt) return;
        if (tag === 'h1') md += `# ${txt}\n\n`;
        else if (tag === 'h2') md += `## ${txt}\n\n`;
        else if (tag === 'h3') md += `### ${txt}\n\n`;
        else if (tag === 'li') md += `- ${txt}\n`;
        else md += `${txt}\n\n`;
      });
      try { await navigator.clipboard.writeText(md); alert('Copied lesson content as Markdown to clipboard.'); }
      catch(e){ alert('Could not copy to clipboard.'); }
    });

    /* Mini Quiz grading */
    const miniAnswers = {mq1:'a', mq2:'b'};
    document.getElementById('gradeMini').addEventListener('click', () => {
      let score = 0, total = 2;
      const resultEl = document.getElementById('miniResult');
      for (let i=1;i<=2;i++){
        const name = 'mq' + i;
        const sel = document.querySelector(`input[name="${name}"]:checked`);
        if (sel && sel.value === miniAnswers[name]) score++;
      }
      const pct = Math.round((score/total) * 100);
      resultEl.textContent = `Score: ${score}/${total} (${pct}%)`;
      resultEl.style.color = pct >= 80 ? '#7ef0c1' : pct >= 60 ? '#ffd66e' : '#ff7e93';
      document.getElementById('gradeMini').disabled = true;
    });
    document.getElementById('resetMini').addEventListener('click', () => {
      document.querySelectorAll('input[name^="mq"]').forEach(i => i.checked = false);
      document.getElementById('miniResult').textContent = '';
      document.getElementById('gradeMini').disabled = false;
    });

    /* TTS module (Web Speech API) */
    (function () {
      if (!('speechSynthesis' in window)) {
        console.warn('TTS not supported in this browser.');
        const bar = document.getElementById('ttsBar'); if (bar) bar.style.display = 'none';
        return;
      }

      const playBtn = document.getElementById('ttsPlay');
      const pauseBtn = document.getElementById('ttsPause');
      const stopBtn = document.getElementById('ttsStop');
      const voicesSelect = document.getElementById('ttsVoices');
      const rateInput = document.getElementById('ttsRate');
      const pitchInput = document.getElementById('ttsPitch');
      const autoBtn = document.getElementById('ttsToggleAuto');

      const contentRoot = document.querySelector('main') || document.body;
      let voices = [];
      let sentences = [];
      let idx = 0;

      function populateVoices(){
        voices = speechSynthesis.getVoices();
        voicesSelect.innerHTML = '';
        voices.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v.voiceURI;
          opt.textContent = `${v.name} (${v.lang})${v.default ? ' — default' : ''}`;
          voicesSelect.appendChild(opt);
        });
        const saved = localStorage.getItem('lesson2.voice');
        if (saved) voicesSelect.value = saved;
      }
      populateVoices();
      if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = populateVoices;

      function getText(){
        if (!contentRoot) return document.body.innerText;
        const nodes = contentRoot.querySelectorAll('h1,h2,h3,h4,p,li');
        return Array.from(nodes).map(n => n.innerText.trim()).filter(Boolean).join('.\n');
      }
      function buildSentences(text){
        return text.split(/(?<=[.?!])\s+/);
      }

      function speakAll(){
        cancel();
        const raw = getText();
        sentences = buildSentences(raw);
        idx = 0;
        speakNext();
      }
      function speakNext(){
        if (idx >= sentences.length) return;
        const s = sentences[idx++];
        const u = new SpeechSynthesisUtterance(s);
        const selURI = voicesSelect.value;
        const sel = voices.find(v => v.voiceURI === selURI) || voices.find(v => v.default) || voices[0];
        if (sel) u.voice = sel;
        u.rate = parseFloat(rateInput.value);
        u.pitch = parseFloat(pitchInput.value);
        u.onstart = () => highlightSentence(s);
        u.onend = () => { removeHighlights(); setTimeout(()=> speakNext(), 80); };
        speechSynthesis.speak(u);
      }
      function cancel(){ if (speechSynthesis.speaking || speechSynthesis.pending) speechSynthesis.cancel(); }
      function pause(){ if (speechSynthesis.speaking) speechSynthesis.pause(); }
      function resume(){ if (speechSynthesis.paused) speechSynthesis.resume(); }

      function highlightSentence(sentence){
        removeHighlights();
        const root = document.querySelector('.lesson-content');
        if (!root) return;
        const safe = sentence.replace(/[.*+?^${}()|[\]\\]/g, '\\$&').trim().slice(0, 300);
        if (!safe) return;
        const regex = new RegExp(safe);
        root.innerHTML = root.innerHTML.replace(regex, `<span class="tts-highlight">${sentence}</span>`);
      }
      function removeHighlights(){
        const root = document.querySelector('.lesson-content');
        if (!root) return;
        const els = root.querySelectorAll('.tts-highlight');
        els.forEach(el => { el.outerHTML = el.textContent; });
      }

      playBtn.addEventListener('click', () => {
        if (speechSynthesis.paused) return resume();
        if (speechSynthesis.speaking) return;
        speakAll();
        localStorage.setItem('lesson2.voice', voicesSelect.value || '');
        localStorage.setItem('lesson2.rate', rateInput.value);
        localStorage.setItem('lesson2.pitch', pitchInput.value);
      });
      pauseBtn.addEventListener('click', () => {
        if (speechSynthesis.speaking) pause();
        else if (speechSynthesis.paused) resume();
      });
      stopBtn.addEventListener('click', () => { cancel(); removeHighlights(); });

      voicesSelect.addEventListener('change', ()=> localStorage.setItem('lesson2.voice', voicesSelect.value));
      rateInput.addEventListener('change', ()=> localStorage.setItem('lesson2.rate', rateInput.value));
      pitchInput.addEventListener('change', ()=> localStorage.setItem('lesson2.pitch', pitchInput.value));
      const savedAuto = localStorage.getItem('lesson2.auto') === 'true';
      autoBtn.style.opacity = savedAuto ? '1' : '0.6';
      autoBtn.addEventListener('click', ()=> {
        const cur = localStorage.getItem('lesson2.auto') === 'true';
        localStorage.setItem('lesson2.auto', (!cur).toString());
        autoBtn.style.opacity = (!cur) ? '1' : '0.6';
      });

      const applySaved = () => {
        const sv = localStorage.getItem('lesson2.voice');
        if (sv && voices.find(v=>v.voiceURI===sv)) voicesSelect.value = sv;
        const sr = localStorage.getItem('lesson2.rate') || rateInput.value;
        const sp = localStorage.getItem('lesson2.pitch') || pitchInput.value;
        rateInput.value = sr; pitchInput.value = sp;
        if (localStorage.getItem('lesson2.auto') === 'true') {
          try { speakAll(); } catch(e) { console.warn('Auto TTS blocked'); }
        }
      };

      let tries = 0;
      const iv = setInterval(()=> {
        if (speechSynthesis.getVoices().length) {
          populateVoices(); applySaved(); clearInterval(iv);
        } else if (++tries > 30) { applySaved(); clearInterval(iv); }
      }, 200);
    })();
  </script>
</body>
</html>
