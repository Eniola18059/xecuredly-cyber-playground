<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lesson 5 â€“ Applications & Web Security</title>

  <style>
    :root {
      --bg: #0b1220;
      --card: #111a2e;
      --muted: #8aa0c3;
      --text: #e7eefc;
      --accent: #6ea8ff;
      --accent-2: #7ef0c1;
      --warning: #ffdf6e;
      --danger: #ff7e93;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Noto Sans,Helvetica,Arial}
    body{color:var(--text); background:linear-gradient(135deg,#0b1220 0%,#101b34 100%); -webkit-font-smoothing:antialiased;}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    header{position:sticky;top:0;z-index:20;backdrop-filter:saturate(160%) blur(8px);background:rgba(11,18,32,0.7);border-bottom:1px solid rgba(255,255,255,0.06)}
    .header-row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .badge{display:inline-flex;align-items:center;gap:8px;font-weight:600;color:#0b1220;background:linear-gradient(135deg,var(--accent),var(--accent-2));padding:8px 12px;border-radius:999px;font-size:12px;text-transform:uppercase;letter-spacing:.06em}
    .hero{padding:28px 20px 8px}
    .title{font-size:clamp(28px,4vw,40px);line-height:1.15;margin:4px 0 10px}
    .subtitle{color:var(--muted);font-size:15px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .chip{padding:6px 10px;background:rgba(255,255,255,0.04);border-radius:999px;font-size:12px;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}
    .card{background:radial-gradient(140% 120% at 100% 0%,#132349 0%,var(--card) 45%);border:1px solid rgba(255,255,255,0.06);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25);margin-top:16px}
    .list{margin:0;padding-left:18px}
    .list li{margin:8px 0}
    .callout{background:linear-gradient(180deg,rgba(126,240,193,.06),rgba(126,240,193,.02));border:1px solid rgba(126,240,193,.14);padding:12px 14px;border-radius:12px;margin-top:10px}
    .q-card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;margin:10px 0}
    .q-options{display:grid;gap:8px;margin-top:8px}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.12);color:var(--text);padding:10px 14px;border-radius:12px;background:rgba(255,255,255,.05);cursor:pointer;font-weight:600}
    .btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#0b1220;border:none}
    .btn.ghost{background:transparent}
    .result{font-size:18px;font-weight:700}
    .good{color:var(--accent-2)}
    .mid{color:var(--warning)}
    .bad{color:var(--danger)}
    footer{opacity:.7;font-size:13px;padding:30px 0 60px}
    .section-title{margin:0 0 8px}
    .muted{color:var(--muted)}
    pre{white-space:pre-wrap}
    .meta{display:flex;gap:8px;flex-wrap:wrap}
    .attempt-btn{margin-top:12px}
    .long-read{line-height:1.65;font-size:15px}
    .small{font-size:13px;color:var(--muted)}
    .explain{margin-top:8px;background:rgba(0,0,0,0.18);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
  </style>
</head>
<body>
  <header>
    <div class="container header-row">
      <div style="display:flex;align-items:center;gap:12px">
        <span class="badge">Lesson 5</span>
        <div>
          <strong>Applications & Web Security â€” Lesson 5</strong>
          <div class="small muted">Web servers, architectures, attacks, LFI walkthrough</div>
        </div>
      </div>
      <div>
        <button class="btn ghost" id="toggleTheme" title="Toggle contrast">ðŸŒ— Theme</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero card">
      <h1 class="title">Applications & Web Security</h1>
      <p class="subtitle">An introduction to web servers, how they work, common attacks on web infrastructure and web applications, countermeasures and a hands-on LFI example.</p>

      <div class="chips">
        <span class="chip">Web Server</span>
        <span class="chip">WAF</span>
        <span class="chip">XSS</span>
        <span class="chip">SQLi</span>
        <span class="chip">LFI</span>
      </div>
    </section>

    <!-- TOC -->
    <section class="card long-read" aria-labelledby="toc">
      <h2 id="toc" class="section-title">Table of Content</h2>
      <ol class="list">
        <li>What Is A Web Server?</li>
        <li>Web Server Architecture</li>
        <li>How Web Servers Work?</li>
        <li>What Is Web Security?</li>
        <li>Web Server Attacks</li>
        <li>Countermeasures & Patch Management</li>
        <li>Difference Between Websites & Web Applications</li>
        <li>Web Application Architecture</li>
        <li>Web Application Attacks</li>
        <li>Local File Inclusion (LFI) â€” example on bWAPP</li>
      </ol>
    </section>

    <!-- What is a web server -->
    <section class="card long-read" aria-labelledby="whatserver">
      <h2 id="whatserver" class="section-title">What Is A Web Server?</h2>
      <p>A web server is hardware and software that uses HTTP (and related protocols) to respond to client requests and deliver web content. It stores, processes and serves webpages and assets (HTML, CSS, JS, images) to users and API clients.</p>
    </section>

    <!-- Web server architecture -->
    <section class="card long-read" aria-labelledby="arch">
      <h2 id="arch" class="section-title">Web Server Architecture</h2>
      <h3>Single-Tier (Single Server)</h3>
      <p>One server handles everything: request processing, application logic and storage. Simple but limited in scale and fault tolerance.</p>

      <h3>Multi-Tier (Load-Balanced)</h3>
      <p>Multiple servers (often behind a load balancer) share work. Typical tiers: load balancer â†’ web/app servers â†’ database. This improves scalability, fault tolerance and maintainability.</p>
    </section>

    <!-- How web servers work -->
    <section class="card long-read" aria-labelledby="how">
      <h2 id="how" class="section-title">How Web Servers Work</h2>
      <p>Clients send HTTP(S) requests to the server. The server processes requests (static file lookup, or forwards to application code), and returns an HTTP response with status, headers and body. TLS (via HTTPS) encrypts traffic in transit.</p>
    </section>

    <!-- What is web security -->
    <section class="card long-read" aria-labelledby="websec">
      <h2 id="websec" class="section-title">What Is Web Security?</h2>
      <p>Web security protects websites and web applications from unauthorized access, data disclosure, tampering and availability loss. It includes secure coding, infrastructure hardening, monitoring and incident response.</p>
    </section>

    <!-- web server attacks -->
    <section class="card long-read" aria-labelledby="attacks">
      <h2 id="attacks" class="section-title">Web Server Attacks</h2>
      <ul class="list">
        <li><strong>DoS/DDoS</strong> â€” flood the server to make it unavailable.</li>
        <li><strong>Malware</strong> â€” compromise the server software or file system.</li>
        <li><strong>Session Hijacking</strong> â€” steal session tokens or cookies to impersonate users.</li>
        <li><strong>DNS Spoofing</strong> â€” redirect users to attacker-controlled sites.</li>
      </ul>
    </section>

    <!-- countermeasures -->
    <section class="card long-read" aria-labelledby="counter">
      <h2 id="counter" class="section-title">Countermeasures & Patch Management</h2>
      <ul class="list">
        <li><strong>Web Application Firewall (WAF)</strong> â€” filter/inspect HTTP traffic for malicious payloads.</li>
        <li><strong>SSL/TLS</strong> â€” encrypt communications (use strong TLS versions and ciphers).</li>
        <li><strong>IDS/IPS</strong> â€” detect and optionally block suspicious behavior.</li>
        <li><strong>Patch Management</strong> â€” keep web server software, frameworks and libraries up to date to fix vulnerabilities.</li>
      </ul>
    </section>

    <!-- difference websites vs web apps -->
    <section class="card long-read" aria-labelledby="diff">
      <h2 id="diff" class="section-title">Difference Between Websites & Web Applications</h2>
      <table style="width:100%;border-collapse:collapse">
        <thead style="text-align:left;color:var(--muted)">
          <tr><th style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.04)">Feature</th><th style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.04)">Website</th><th style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.04)">Web Application</th></tr>
        </thead>
        <tbody>
          <tr><td style="padding:8px">Interactivity</td><td style="padding:8px">Primarily static</td><td style="padding:8px">Highly interactive</td></tr>
          <tr><td style="padding:8px">Functionality</td><td style="padding:8px">Informational</td><td style="padding:8px">Task-oriented</td></tr>
          <tr><td style="padding:8px">Complexity</td><td style="padding:8px">Simple</td><td style="padding:8px">Complex with database & logic</td></tr>
          <tr><td style="padding:8px">Examples</td><td style="padding:8px">Blogs, news sites</td><td style="padding:8px">Gmail, Amazon</td></tr>
        </tbody>
      </table>
    </section>

    <!-- web app architecture -->
    <section class="card long-read" aria-labelledby="webapp">
      <h2 id="webapp" class="section-title">Web Application Architecture</h2>
      <p><strong>Single-Tier (Client-side)</strong> â€” app runs mostly in the browser (static). <strong>Multi-Tier (Server-side)</strong> â€” presentation tier (client), application tier (business logic), data tier (database).</p>
    </section>

    <!-- web app attacks -->
    <section class="card long-read" aria-labelledby="webattacks">
      <h2 id="webattacks" class="section-title">Web Application Attacks</h2>
      <ul class="list">
        <li><strong>Cross-Site Scripting (XSS)</strong> â€” inject scripts into pages to run in victims' browsers.</li>
        <li><strong>SQL Injection (SQLi)</strong> â€” inject SQL to manipulate or exfiltrate data.</li>
        <li><strong>Broken Authentication</strong> â€” weak auth/session handling enabling account takeover.</li>
        <li><strong>Sensitive Data Exposure</strong> â€” improper handling or storage of secrets.</li>
        <li><strong>File Upload Vulnerabilities</strong> â€” allow execution of uploaded malicious files.</li>
      </ul>
    </section>

    <!-- LFI example -->
    <section class="card long-read" aria-labelledby="lfi">
      <h2 id="lfi" class="section-title">Local File Inclusion (LFI) â€” bWAPP Example</h2>
      <p>Local File Inclusion is a vulnerability that lets an attacker include files from the web server filesystem through the browser. It can expose sensitive files (like <code>/etc/passwd</code>) or lead to remote code execution depending on server configuration.</p>

      <h3>Example steps (training lab: bWAPP)</h3>
      <ol class="list">
        <li>Check the target machine IP (e.g., run <code>ifconfig</code> on the target). Note the web server IP.</li>
        <li>From your attacker machine (e.g., Kali), open a browser and navigate to the target IP, e.g. <code>http://10.0.0.169</code>.</li>
        <li>Open bWAPP and login (commonly <code>bee/bug</code> in labs).</li>
        <li>Select the vulnerability module (Directory Traversal / LFI) and click "Hack".</li>
        <li>Observe the URL pattern, e.g. <code>/bWAPP/directory_traversal_1.php?page=message.txt</code>.</li>
        <li>Replace the filename with a traversal payload, e.g. <code>../../../../etc/passwd</code>, so the URL becomes: <code>/bWAPP/directory_traversal_1.php?page=../../../../etc/passwd</code>.</li>
        <li>Submit and review the server response â€” if vulnerable, the contents of the file will be returned in the browser.</li>
      </ol>

      <div class="callout">
        <strong>Important:</strong> Only perform these steps in authorized, isolated lab environments (e.g., intentionally vulnerable VMs like bWAPP). Never test against systems you do not own or have permission to assess.
      </div>
    </section>

    <!-- Download notes -->
    <section class="card" aria-labelledby="notes">
      <h2 id="notes" class="section-title">Download Notes</h2>
      <p class="muted">Click to download a plain-text version of this lesson.</p>
      <div style="display:flex;gap:12px;align-items:center;margin-top:12px;">
        <button class="btn primary" id="downloadNotesTop">ðŸ“¥ Download Notes (Text)</button>
        <div class="meta small"><span>Estimated read time: ~15â€“25 mins</span></div>
      </div>
    </section>

    <!-- QUIZ GATE -->
    <section class="card" aria-labelledby="quiz">
      <h2 id="quiz" class="section-title">Lesson 5 Quiz â€” Applications & Web Security</h2>
      <p class="muted">Click <strong>Attempt Quiz</strong> when ready â€” the quiz is gated so students finish reading first. The quiz has 10 questions; incorrect answers will be highlighted and explanations added.</p>

      <div style="display:flex;gap:12px;align-items:center;margin-top:12px;">
        <button class="btn primary attempt-btn" id="attemptBtn">ðŸ§ª Attempt Quiz</button>
        <button class="btn ghost" id="downloadNotesBottom">ðŸ“¥ Download Notes (Text)</button>
        <div class="meta small"><span>Estimated quiz time: ~5â€“10 mins</span></div>
      </div>

      <form id="quizForm" style="display:none;margin-top:14px;">
        <!-- Q1 -->
        <div class="q-card">
          <h4>1) What protocol do web servers commonly use to serve webpages?</h4>
          <div class="q-options">
            <label><input type="radio" name="q1" value="a"/> FTP</label>
            <label><input type="radio" name="q1" value="b"/> HTTP / HTTPS</label>
            <label><input type="radio" name="q1" value="c"/> SMTP</label>
          </div>
        </div>

        <!-- Q2 -->
        <div class="q-card">
          <h4>2) Which architecture uses a load balancer and multiple servers for scalability?</h4>
          <div class="q-options">
            <label><input type="radio" name="q2" value="a"/> Single-Tier</label>
            <label><input type="radio" name="q2" value="b"/> Multi-Tier (Load-Balanced)</label>
            <label><input type="radio" name="q2" value="c"/> Standalone Laptop</label>
          </div>
        </div>

        <!-- Q3 -->
        <div class="q-card">
          <h4>3) Which of these is a common server-side countermeasure for web attacks?</h4>
          <div class="q-options">
            <label><input type="radio" name="q3" value="a"/> Web Application Firewall (WAF)</label>
            <label><input type="radio" name="q3" value="b"/> Calculator app</label>
            <label><input type="radio" name="q3" value="c"/> Unpatched services</label>
          </div>
        </div>

        <!-- Q4 -->
        <div class="q-card">
          <h4>4) What is Cross-Site Scripting (XSS)?</h4>
          <div class="q-options">
            <label><input type="radio" name="q4" value="a"/> Injecting malicious scripts into web pages to run in other users' browsers</label>
            <label><input type="radio" name="q4" value="b"/> Scanning open ports</label>
            <label><input type="radio" name="q4" value="c"/> Encrypting the database</label>
          </div>
        </div>

        <!-- Q5 -->
        <div class="q-card">
          <h4>5) What is SQL Injection (SQLi)?</h4>
          <div class="q-options">
            <label><input type="radio" name="q5" value="a"/> Supplying malicious SQL through inputs to manipulate backend databases</label>
            <label><input type="radio" name="q5" value="b"/> A way to improve SQL performance</label>
            <label><input type="radio" name="q5" value="c"/> A protocol for sending emails</label>
          </div>
        </div>

        <!-- Q6 -->
        <div class="q-card">
          <h4>6) Which defense helps protect credentials even if a database is leaked?</h4>
          <div class="q-options">
            <label><input type="radio" name="q6" value="a"/> Storing passwords in plain text</label>
            <label><input type="radio" name="q6" value="b"/> Hashing and salting passwords</label>
            <label><input type="radio" name="q6" value="c"/> Publishing credentials publicly</label>
          </div>
        </div>

        <!-- Q7 -->
        <div class="q-card">
          <h4>7) Which vulnerability allows including local files like <code>/etc/passwd</code> via manipulated URLs?</h4>
          <div class="q-options">
            <label><input type="radio" name="q7" value="a"/> Cross-Site Request Forgery (CSRF)</label>
            <label><input type="radio" name="q7" value="b"/> Local File Inclusion (LFI)</label>
            <label><input type="radio" name="q7" value="c"/> Brute-force</label>
          </div>
        </div>

        <!-- Q8 -->
        <div class="q-card">
          <h4>8) Which is a recommended mitigation for file upload vulnerabilities?</h4>
          <div class="q-options">
            <label><input type="radio" name="q8" value="a"/> Accept any file and execute it</label>
            <label><input type="radio" name="q8" value="b"/> Validate file types, restrict execution and store outside webroot</label>
            <label><input type="radio" name="q8" value="c"/> Disable logging</label>
          </div>
        </div>

        <!-- Q9 -->
        <div class="q-card">
          <h4>9) What makes HTTPS important?</h4>
          <div class="q-options">
            <label><input type="radio" name="q9" value="a"/> It encrypts traffic between client and server to protect confidentiality and integrity</label>
            <label><input type="radio" name="q9" value="b"/> It makes pages load faster always</label>
            <label><input type="radio" name="q9" value="c"/> It bypasses firewalls</label>
          </div>
        </div>

        <!-- Q10 -->
        <div class="q-card">
          <h4>10) Best practice when testing vulnerabilities like LFI:</h4>
          <div class="q-options">
            <label><input type="radio" name="q10" value="a"/> Test only in authorized, isolated lab environments</label>
            <label><input type="radio" name="q10" value="b"/> Run tests against public production sites without permission</label>
            <label><input type="radio" name="q10" value="c"/> Share discovered vulnerabilities on social media immediately</label>
          </div>
        </div>

        <div style="display:flex;gap:10px;align-items:center;margin-top:12px;">
          <button type="button" class="btn primary" id="submitQuiz">Submit Quiz</button>
          <button type="button" class="btn" id="resetQuiz">Reset</button>
          <span id="quizResult" class="result" aria-live="polite"></span>
        </div>
      </form>
    </section>

    <footer class="container">
      <p>Â© Learning Playground â€“ Applications & Web Security â€¢ Lesson 5</p>
    </footer>
  </main>

  <script>
    /* Theme toggle (persist) */
    const themeBtn = document.getElementById('toggleTheme');
    const keyTheme = 'lesson5-theme';
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const applyTheme = (mode) => {
      if (mode === 'light') {
        document.documentElement.style.setProperty('--bg','#f7f9ff');
        document.documentElement.style.setProperty('--card','#ffffff');
        document.documentElement.style.setProperty('--text','#0b1220');
        document.documentElement.style.setProperty('--muted','#4a5875');
        document.body.style.background = 'linear-gradient(135deg,#f7f9ff 0%,#eef4ff 100%)';
      } else {
        document.documentElement.style.setProperty('--bg','#0b1220');
        document.documentElement.style.setProperty('--card','#111a2e');
        document.documentElement.style.setProperty('--text','#e7eefc');
        document.documentElement.style.setProperty('--muted','#8aa0c3');
        document.body.style.background = 'linear-gradient(135deg,#0b1220 0%,#101b34 100%)';
      }
    };
    const storedTheme = localStorage.getItem(keyTheme) || (prefersDark ? 'dark' : 'light');
    applyTheme(storedTheme);
    themeBtn.addEventListener('click', () => {
      const cur = localStorage.getItem(keyTheme) || storedTheme;
      const next = cur === 'dark' ? 'light' : 'dark';
      localStorage.setItem(keyTheme, next);
      applyTheme(next);
    });

    /* Download notes */
    function downloadNotes() {
      const title = 'Lesson5_Web_Security_Notes.txt';
      const content = [
        'Lesson 5 â€“ Applications & Web Security',
        '',
        'Table of Content',
        'What Is A Web Server?',
        'Web Server Architecture',
        'How Web Servers Work?',
        'What Is Web Security?',
        'Web Server Attacks',
        'Countermeasures & Patch Management',
        'Difference Between Websites & Web Applications',
        'Web Application Architecture',
        'Web Application Attacks',
        '',
        'Local File Inclusion (LFI) example steps for labs: check target IP, access bWAPP, select Directory Traversal, replace file parameter with traversal payload like ../../../../etc/passwd (labs only).',
        '',
        'Always test only in authorized labs.'
      ].join('\\n');
      const blob = new Blob([content], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = title; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 500);
    }
    document.getElementById('downloadNotesTop').addEventListener('click', downloadNotes);
    document.getElementById('downloadNotesBottom').addEventListener('click', downloadNotes);

    /* Quiz logic */
    const answers = { q1:'b', q2:'b', q3:'a', q4:'a', q5:'a', q6:'b', q7:'b', q8:'b', q9:'a', q10:'a' };
    const explanations = {
      q1: 'Web servers commonly use HTTP and HTTPS to serve webpages and APIs.',
      q2: 'Multi-Tier (load-balanced) architectures use load balancers and multiple servers for scalability and fault tolerance.',
      q3: 'A Web Application Firewall (WAF) is a common server-side countermeasure to filter malicious HTTP traffic.',
      q4: 'XSS injects malicious scripts into pages which then run in other usersâ€™ browsers.',
      q5: 'SQL Injection involves supplying malicious SQL through inputs to manipulate backend databases.',
      q6: 'Hashing and salting passwords protects credentials even if a database is leaked.',
      q7: 'Local File Inclusion (LFI) allows inclusion of local filesystem files via manipulated parameters/URLs.',
      q8: 'Mitigate file uploads by validating file types, restricting execution and storing files outside the webroot.',
      q9: 'HTTPS encrypts traffic between client and server to protect confidentiality and integrity.',
      q10: 'Vulnerability testing should only be done in authorized, isolated lab environments.'
    };
    const form = document.getElementById('quizForm');
    const submitBtn = document.getElementById('submitQuiz');
    const resetBtn = document.getElementById('resetQuiz');
    const resultSpan = document.getElementById('quizResult');
    const scoreKey = 'lesson5-web-score';
    const attemptBtn = document.getElementById('attemptBtn');

    attemptBtn.addEventListener('click', () => {
      attemptBtn.style.display = 'none';
      quizForm.style.display = 'block';
      localStorage.setItem('lesson5-attempted', '1');
      const saved = localStorage.getItem(scoreKey);
      if (saved) {
        resultSpan.textContent = `Previous Score: ${saved}%`;
        resultSpan.className = 'result ' + (saved >= 80 ? 'good' : saved >= 60 ? 'mid' : 'bad');
        submitBtn.disabled = true;
      }
      quizForm.scrollIntoView({behavior:'smooth', block:'center'});
    });

    function grade() {
      let score = 0; let total = Object.keys(answers).length;
      const missed = [];
      // remove prior inline explanations
      form.querySelectorAll('.q-card .explain').forEach(e => e.remove());
      for (const q of Object.keys(answers)) {
        const el = form.querySelector(`input[name="${q}"]:checked`);
        // clear previous highlight
        form.querySelectorAll(`input[name="${q}"]`).forEach(i => { if (i.parentElement) i.parentElement.style.background=''; });
        if (!el) { missed.push(q); continue; }
        if (el.value === answers[q]) {
          score++;
          el.parentElement.style.background = 'linear-gradient(90deg, rgba(110,168,255,0.12), rgba(126,240,193,0.06))';
        } else {
          missed.push(q);
          el.parentElement.style.background = 'linear-gradient(90deg, rgba(255,126,147,0.07), rgba(0,0,0,0.02))';
        }
      }
      const pct = Math.round((score/total)*100);
      resultSpan.textContent = `Score: ${score}/${total} (${pct}%)`;
      resultSpan.className = 'result ' + (pct >= 80 ? 'good' : pct >= 60 ? 'mid' : 'bad');
      localStorage.setItem(scoreKey, pct);

      // remove old review box
      const existing = document.getElementById('reviewBox'); if (existing) existing.remove();

      if (missed.length) {
        const review = document.createElement('div');
        review.id = 'reviewBox';
        review.style.marginTop = '12px';
        review.style.padding = '12px';
        review.style.border = '1px solid rgba(255,255,255,0.06)';
        review.style.borderRadius = '10px';
        review.style.background = 'linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.12))';
        let inner = '<strong>Review (missed questions)</strong><ul>';
        missed.forEach(m => {
          inner += `<li><strong>${m.toUpperCase()}</strong>: ${explanations[m]}</li>`;
          // attach inline explanation under the missed question
          const radio = form.querySelector(`input[name="${m}"]`);
          if (radio) {
            const qCard = radio.closest('.q-card');
            if (qCard) {
              const ex = document.createElement('div');
              ex.className = 'explain';
              ex.textContent = explanations[m];
              qCard.appendChild(ex);
            }
          }
        });
        inner += '</ul>';
        review.innerHTML = inner;
        form.appendChild(review);
        setTimeout(()=>{ alert('You missed some questions. Explanations have been added under the missed questions.'); }, 80);
      } else {
        const perfect = document.createElement('div');
        perfect.id = 'reviewBox';
        perfect.style.marginTop = '12px';
        perfect.style.padding = '12px';
        perfect.style.border = '1px solid rgba(126,240,193,0.12)';
        perfect.style.borderRadius = '10px';
        perfect.style.background = 'linear-gradient(180deg, rgba(126,240,193,0.04), rgba(126,240,193,0.02))';
        perfect.innerHTML = '<strong>Perfect!</strong> You answered all questions correctly. Well done.';
        form.appendChild(perfect);
      }
      submitBtn.disabled = true;
    }

    function resetQuiz() {
      form.reset();
      form.querySelectorAll('input').forEach(i => { if (i.parentElement) i.parentElement.style.background=''; });
      resultSpan.textContent = '';
      submitBtn.disabled = false;
      const existing = document.getElementById('reviewBox'); if (existing) existing.remove();
      localStorage.removeItem(scoreKey);
    }

    submitBtn.addEventListener('click', grade);
    resetBtn.addEventListener('click', resetQuiz);

    // Restore previous attempt if user already attempted
    const prev = localStorage.getItem(scoreKey);
    if (localStorage.getItem('lesson5-attempted')) {
      attemptBtn.style.display = 'none';
      quizForm.style.display = 'block';
      if (prev) {
        resultSpan.textContent = `Previous Score: ${prev}%`;
        resultSpan.className = 'result ' + (prev >= 80 ? 'good' : prev >= 60 ? 'mid' : 'bad');
        submitBtn.disabled = true;
      }
    }
  </script>
</body>
</html>
